<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cydra Social - Social Media Management Dashboard</title>
    <meta name="description" content="Modern social media management dashboard for agencies and enterprises">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
        }

        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --bg-app: #F8FAFC;
            --bg-card: #FFFFFF;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --border: #E2E8F0;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Dark mode removed */

        body {
            background: var(--bg-app);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.625rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: #64748B;
            color: white;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-danger {
            background: #EF4444;
            color: white;
        }

        .card {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
        }

        .input {
            width: 100%;
            padding: 0.625rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.625rem;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-draft {
            background: #FEF3C7;
            color: #92400E;
        }

        .badge-scheduled {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .badge-published {
            background: #D1FAE5;
            color: #065F46;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 40;
        }

        .header {
            height: 72px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            position: fixed;
            top: 0;
            left: 260px;
            right: 0;
            z-index: 30;
            display: flex;
            align-items: center;
            padding: 0 2rem;
        }

        .variant-content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* ==================== PUBLIC WEBSITE STYLES ==================== */

        /* Hero Section */
        .hero-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 900px;
        }

        .hero-headline {
            font-size: 3.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .hero-subheadline {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2.5rem;
            font-weight: 400;
        }

        .hero-cta-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-hero-primary {
            display: inline-block;
            padding: 1rem 2.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            background: white;
            color: #667eea;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }

        .btn-hero-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-hero-secondary {
            padding: 1rem 2.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            background: transparent;
            color: white;
            border: 2px solid white;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-hero-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        /* Pricing Section */
        .pricing-section {
            padding: 5rem 2rem;
            background: var(--bg-app);
        }

        .pricing-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .pricing-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .pricing-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .pricing-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .pricing-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pricing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .pricing-card.featured {
            border: 2px solid var(--primary);
            transform: scale(1.02);
        }

        .pricing-card.featured::before {
            content: 'Most Popular';
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0 0.875rem 0 1rem;
        }

        .pricing-plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .pricing-plan-price {
            display: flex;
            align-items: baseline;
            gap: 0.25rem;
            margin-bottom: 1rem;
        }

        .price-amount {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
        }

        .price-period {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .pricing-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .pricing-features {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
        }

        .pricing-features li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .pricing-features li::before {
            content: 'âœ“';
            color: #22c55e;
            font-weight: bold;
        }

        .pricing-cta {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pricing-cta.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .pricing-cta.primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .pricing-cta.secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .pricing-cta.secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Public Footer */
        .public-footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border-light);
            padding: 3rem 2rem;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .footer-brand img {
            height: 40px;
        }

        .footer-brand span {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .footer-links {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
            cursor: pointer;
        }

        .footer-link:hover {
            color: var(--primary);
        }

        .footer-copyright {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Public Navbar */
        .public-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .dark .public-navbar {
            background: rgba(24, 24, 27, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .navbar-brand img {
            height: 45px;
        }

        .navbar-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .navbar-link {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .navbar-link:hover {
            background: var(--bg-hover);
        }

        /* Legal Pages */
        .legal-page {
            min-height: 100vh;
            padding-top: 80px;
            background: var(--bg-app);
        }

        .legal-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .legal-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .legal-updated {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 2rem;
        }

        .legal-section {
            margin-bottom: 2rem;
        }

        .legal-section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .legal-section p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        .legal-section ul {
            color: var(--text-secondary);
            line-height: 1.8;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }

        /* Calendar Grid (SCHED-02) */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .calendar-grid>div {
            background: var(--bg-card);
        }

        .calendar-day {
            min-height: 120px;
            padding: 0.5rem;
            position: relative;
        }

        .calendar-day:hover {
            background: #F8FAFC;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .hero-headline {
                font-size: 2.5rem;
            }

            .hero-subheadline {
                font-size: 1.125rem;
            }

            .pricing-cards {
                grid-template-columns: 1fr;
            }

            .pricing-card.featured {
                transform: none;
            }

            .footer-container {
                flex-direction: column;
                text-align: center;
            }
        }

        /* ==================== AUTH FORM STYLES (Epic 2) ==================== */

        /* Form Validation States */
        .input-wrapper {
            position: relative;
            margin-bottom: 1rem;
        }

        .input-wrapper .input {
            padding-right: 40px;
        }

        .input-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
        }

        .input.valid {
            border-color: #10B981;
        }

        .input.invalid {
            border-color: #EF4444;
        }

        .validation-message {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .validation-message.error {
            color: #EF4444;
        }

        .validation-message.success {
            color: #10B981;
        }

        .validation-message.info {
            color: var(--text-secondary);
        }

        /* Password Strength Meter */
        .password-strength {
            margin-top: 0.5rem;
        }

        .strength-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .strength-fill.weak {
            width: 33%;
            background: #EF4444;
        }

        .strength-fill.medium {
            width: 66%;
            background: #F59E0B;
        }

        .strength-fill.strong {
            width: 100%;
            background: #10B981;
        }

        .strength-text {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            color: var(--text-secondary);
        }

        /* SSO Buttons (AUTH-02) */
        .sso-divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .sso-divider::before,
        .sso-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .sso-divider span {
            padding: 0 1rem;
        }

        .sso-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .sso-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .sso-btn:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
        }

        .sso-btn.google {
            border-color: #4285F4;
        }

        .sso-btn.google:hover {
            background: rgba(66, 133, 244, 0.1);
        }

        .sso-btn.meta {
            border-color: #1877F2;
        }

        .sso-btn.meta:hover {
            background: rgba(24, 119, 242, 0.1);
        }

        .sso-btn.linkedin {
            border-color: #0A66C2;
        }

        .sso-btn.linkedin:hover {
            background: rgba(10, 102, 194, 0.1);
        }

        .sso-btn.twitter {
            border-color: #000000;
        }

        .sso-btn.twitter:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Email Verification Banner (AUTH-04) */
        .verification-banner {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
        }

        .verification-banner p {
            margin: 0;
            font-size: 0.9rem;
        }

        .verification-banner button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .verification-banner button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Read-only Mode Overlay */
        .read-only-overlay {
            position: relative;
        }

        .read-only-overlay::after {
            content: 'ðŸ”’ Verify email to unlock';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .read-only-overlay:hover::after {
            opacity: 1;
        }

        /* ==================== ONBOARDING STYLES (Epic 3) ==================== */

        /* Onboarding Steps Progress */
        .onboarding-progress {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .onboarding-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .step-number {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .step-number.completed {
            background: #10B981;
            color: white;
        }

        .step-number.active {
            background: var(--primary);
            color: white;
        }

        .step-number.inactive {
            background: var(--border);
            color: var(--text-secondary);
        }

        .step-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .step-connector {
            width: 40px;
            height: 2px;
            background: var(--border);
        }

        .step-connector.completed {
            background: #10B981;
        }

        /* Slug Generator (ONB-01, ONB-02) */
        .slug-input-group {
            display: flex;
            align-items: center;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .slug-prefix {
            background: var(--bg-app);
            padding: 0.875rem 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-right: 1px solid var(--border);
            white-space: nowrap;
        }

        .slug-input-group input {
            border: none;
            flex: 1;
            padding: 0.875rem 1rem;
            font-size: 1rem;
            background: transparent;
            color: var(--text-primary);
        }

        .slug-input-group input:focus {
            outline: none;
        }

        .slug-suggestions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .slug-suggestion {
            padding: 0.25rem 0.75rem;
            background: var(--bg-app);
            border: 1px solid var(--border);
            border-radius: 1rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .slug-suggestion:hover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }

        /* Timezone Dropdown (ONB-03) */
        .searchable-dropdown {
            position: relative;
        }

        .searchable-dropdown input {
            width: 100%;
        }

        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
        }

        .dropdown-list.open {
            display: block;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .dropdown-item:hover {
            background: var(--bg-hover);
        }

        /* Logo Upload (ONB-04) */
        .logo-upload-area {
            border: 2px dashed var(--border);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo-upload-area:hover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.05);
        }

        .logo-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }

        .logo-preview {
            width: 100px;
            height: 100px;
            border-radius: 0.75rem;
            object-fit: cover;
            border: 2px solid var(--border);
        }

        .avatar-initials {
            width: 100px;
            height: 100px;
            border-radius: 0.75rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 0 auto;
        }

        /* Completeness Meter (ONB-07) */
        .completeness-meter {
            margin-bottom: 1.5rem;
        }

        .completeness-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .completeness-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .completeness-percent {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
        }

        .completeness-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .completeness-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        /* Brand Tone Button Group (ONB-07) */
        .tone-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tone-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 2rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: var(--text-primary);
        }

        .tone-btn:hover {
            border-color: var(--primary);
        }

        .tone-btn.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Auth Page Container */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-app);
            padding: 2rem;
        }

        .auth-card {
            max-width: 450px;
            width: 100%;
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header img {
            height: 60px;
            margin-bottom: 1rem;
        }

        .auth-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            color: var(--text-secondary);
        }

        .auth-link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: none;
            font-weight: 500;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        .form-row {
            margin-bottom: 1rem;
        }

        .form-row label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .form-checkbox input[type="checkbox"] {
            margin-top: 0.25rem;
        }

        .form-checkbox label {
            margin: 0;
            font-size: 0.875rem;
            font-weight: normal;
        }

        /* Onboarding Page Layout */
        .onboarding-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }

        .onboarding-container {
            max-width: 600px;
            width: 100%;
            background: var(--bg-card);
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .onboarding-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .onboarding-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .onboarding-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .onboarding-progress-container {
            margin-bottom: 2rem;
        }

        .onboarding-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .onboarding-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .onboarding-step.active {
            opacity: 1;
        }

        .onboarding-step.completed {
            opacity: 1;
        }

        .onboarding-step.completed .step-number {
            background: #10B981;
            color: white;
        }

        .onboarding-step.active .step-number {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
        }

        .onboarding-step span {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .onboarding-step.active span {
            color: var(--primary);
        }

        .onboarding-content {
            margin-bottom: 2rem;
        }

        .onboarding-actions {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }

        .form-help {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .required {
            color: #EF4444;
        }

        .slug-preview {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-family: monospace;
        }

        .slug-input {
            border: none !important;
            flex: 1;
        }

        .logo-placeholder {
            padding: 2rem;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .upload-text {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .upload-hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .onboarding-summary {
            background: var(--bg-app);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .onboarding-summary h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .summary-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-value {
            font-weight: 500;
            color: var(--text-primary);
        }

        .skip-link {
            text-align: center;
            margin-top: 1.5rem;
        }

        .verification-banner.warning {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            position: relative;
            top: auto;
            left: auto;
            right: auto;
        }

        .verification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .verification-icon {
            font-size: 1.5rem;
        }

        .completeness-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            display: block;
            text-align: right;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
        }

        /* Compact Auth Styles - No Scroll */
        .auth-card.compact {
            padding: 1.75rem;
            max-width: 420px;
        }

        .auth-header.compact {
            margin-bottom: 1.25rem;
        }

        .auth-header.compact img {
            margin-bottom: 0.5rem;
        }

        .auth-header.compact .auth-title {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .auth-header.compact .auth-subtitle {
            font-size: 0.875rem;
        }

        /* SSO Grid Layout (2x2) */
        .sso-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .sso-grid .sso-btn {
            padding: 0.625rem 0.75rem;
            font-size: 0.8rem;
            gap: 0.5rem;
        }

        .sso-divider.compact {
            margin: 1rem 0;
        }

        /* Compact Form Styles */
        .compact-form .form-row.compact {
            margin-bottom: 0.75rem;
        }

        .compact-form .form-row.compact label {
            margin-bottom: 0.375rem;
            font-size: 0.8rem;
        }

        .input.compact {
            padding: 0.625rem 0.875rem;
            font-size: 0.875rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        @media (max-width: 500px) {
            .sso-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .main-content {
            margin-left: 260px;
            margin-top: 72px;
            padding: 2rem;
            min-height: calc(100vh - 72px);
            max-width: 1400px;
        }

        .nav-item {
            padding: 0.75rem 1.25rem;
            margin: 0.25rem 0.75rem;
            border-radius: 0.625rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
        }

        .nav-item:hover {
            background: rgba(79, 70, 229, 0.1);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .platform-card {
            border: 2px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .platform-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .platform-card.selected {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.05);
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Checkout modal: scrollable body + sticky footer so Pay button is always visible */
        .checkout-modal-content {
            max-width: 480px;
            width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 12px;
            background: var(--bg-card);
        }
        .checkout-modal-body {
            overflow-y: auto;
            flex: 1;
            min-height: 0;
            -webkit-overflow-scrolling: touch;
        }
        .checkout-modal-footer {
            flex-shrink: 0;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--bg-card);
        }
        .checkout-modal-footer .btn { border-radius: 8px; }
        .checkout-qty-input {
            width: 3.5rem;
            padding: 0.5rem 0.35rem;
            text-align: center;
            font-weight: 600;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        .checkout-qty-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--bg-card);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            display: none;
            border-left: 4px solid var(--primary);
        }

        .toast.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .spinner {
            border: 3px solid rgba(79, 70, 229, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .header {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }
        }

        .hidden {
            display: none !important;
        }

        .grid-auto {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .stat-card {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .activity-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            align-items: start;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.5rem;
            min-height: 100px;
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(79, 70, 229, 0.05);
        }

        .content-table {
            width: 100%;
            border-collapse: collapse;
        }

        .content-table th {
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .content-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .content-table tr:hover {
            background: rgba(79, 70, 229, 0.02);
        }

        .ai-variant-card {
            border: 2px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.2s ease;
        }

        .ai-variant-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .platform-icon {
            width: 32px;
            height: 32px;
            border-radius: 0.375rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
            color: white;
        }

        .platform-linkedin {
            background: #0A66C2;
        }

        .platform-twitter {
            background: #1DA1F2;
        }

        .platform-facebook {
            background: #1877F2;
        }

        .platform-instagram {
            background: linear-gradient(45deg, #F58529, #DD2A7B, #8134AF);
        }

        /* Spinner Animation for OAuth flow */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Entrance Animation for staggered reveals */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Social Platform Card Hover Effect */
        .social-platform-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg) !important;
        }

        /* Demo Animations */
        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-20px);
            }

            60% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Demo banner */
        .demo-banner {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            text-align: center;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 9999;
        }

        .demo-banner kbd {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* Credit counter badge */
        .credit-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .credit-badge.low {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }

        .credit-badge.critical {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            animation: pulse 1s infinite;
        }
    </style>
</head>

<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- App Container -->
    <div id="app"></div>

    <script>
        const APP_LOGO = 'assets/cydra-logo.png';
        // ==================== STATE MANAGEMENT ====================
        class Store {
            constructor() {
                this.state = {
                    user: null,
                    currentWorkspace: null,
                    workspaces: [],
                    posts: [],
                    activities: [],
                    mediaLibrary: [],
                    darkMode: false,
                    isFirstLogin: false
                };
                this.loadFromStorage();
            }

            loadFromStorage() {
                const saved = localStorage.getItem('cydra_state');
                if (saved) {
                    this.state = { ...this.state, ...JSON.parse(saved) };
                } else {
                    this.seedDemoData();
                }
            }

            saveToStorage() {
                localStorage.setItem('cydra_state', JSON.stringify(this.state));
            }

            seedDemoData() {
                this.state.workspaces = [
                    {
                        id: 'ws1',
                        name: 'Acme Corp Marketing',
                        slug: 'acme-corp',
                        legalName: 'Acme Corporation LLC',
                        businessType: 'Marketing Agency',
                        industry: 'Technology',
                        description: 'Leading marketing agency specializing in tech startups and SaaS companies.',
                        timezone: 'America/New_York',
                        address: '123 Innovation Drive',
                        city: 'San Francisco',
                        state: 'CA',
                        zip: '94105',
                        country: 'United States',
                        website: 'https://acmecorp.com',
                        phone: '+1 (555) 123-4567',
                        connections: {
                            linkedin: { connected: true, handle: '@acmecorp' },
                            twitter: { connected: true, handle: '@acme' },
                            facebook: { connected: false, handle: '' },
                            instagram: { connected: true, handle: '@acmecorp' }
                        },
                        aiCredits: 25,
                        plan: 'solo',
                        subscriptionStatus: 'active',
                        createdAt: new Date('2025-12-01').toISOString()
                    },
                    {
                        id: 'ws2',
                        name: 'TechStart Ventures',
                        slug: 'techstart',
                        legalName: 'TechStart Ventures Inc.',
                        businessType: 'SaaS',
                        industry: 'Software',
                        description: 'Innovative SaaS platform for enterprise solutions.',
                        timezone: 'America/Los_Angeles',
                        address: '456 Startup Lane',
                        city: 'Austin',
                        state: 'TX',
                        zip: '78701',
                        country: 'United States',
                        website: 'https://techstart.io',
                        phone: '+1 (555) 987-6543',
                        connections: {
                            linkedin: { connected: true, handle: '@techstart' },
                            twitter: { connected: false, handle: '' },
                            facebook: { connected: false, handle: '' },
                            instagram: { connected: false, handle: '' }
                        },
                        aiCredits: 50,
                        plan: 'team',
                        subscriptionStatus: 'active',
                        createdAt: new Date('2025-11-15').toISOString()
                    }
                ];
                this.state.currentWorkspace = 'ws1';

                this.state.posts = [
                    {
                        id: 'p1',
                        workspaceId: 'ws1',
                        content: 'Excited to announce our new product launch! ðŸš€ #innovation #tech',
                        platforms: ['linkedin', 'twitter'],
                        status: 'published',
                        date: new Date('2025-12-20').toISOString(),
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'p2',
                        workspaceId: 'ws1',
                        content: 'Join us for our webinar on digital transformation next week! #webinar #digitaltransformation',
                        platforms: ['linkedin', 'facebook'],
                        status: 'scheduled',
                        date: new Date('2025-12-28').toISOString(),
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'p3',
                        workspaceId: 'ws1',
                        content: 'Working on something amazing... stay tuned! #comingsoon',
                        platforms: ['twitter', 'instagram'],
                        status: 'draft',
                        date: null,
                        createdAt: new Date().toISOString()
                    }
                ];

                this.state.activities = [
                    { id: 'a1', type: 'published', content: 'Published post to LinkedIn and Twitter', time: '2 hours ago' },
                    { id: 'a2', type: 'scheduled', content: 'Scheduled post for Dec 28', time: '5 hours ago' },
                    { id: 'a3', type: 'draft', content: 'Saved new draft', time: '1 day ago' }
                ];

                this.saveToStorage();
            }

            getWorkspace(id) {
                return this.state.workspaces.find(w => w.id === id);
            }

            getCurrentWorkspace() {
                return this.getWorkspace(this.state.currentWorkspace);
            }

            switchWorkspace(id) {
                this.state.currentWorkspace = id;
                this.saveToStorage();
            }

            addWorkspace(workspace) {
                workspace.id = 'ws' + Date.now();
                workspace.slug = workspace.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
                workspace.createdAt = new Date().toISOString();
                workspace.connections = {
                    linkedin: { connected: false, handle: '' },
                    twitter: { connected: false, handle: '' },
                    facebook: { connected: false, handle: '' },
                    instagram: { connected: false, handle: '' }
                };
                this.state.workspaces.push(workspace);
                this.saveToStorage();
                return workspace;
            }

            updateWorkspace(id, updates) {
                const index = this.state.workspaces.findIndex(w => w.id === id);
                if (index !== -1) {
                    this.state.workspaces[index] = { ...this.state.workspaces[index], ...updates };
                    this.saveToStorage();
                }
            }

            deleteWorkspace(id) {
                this.state.workspaces = this.state.workspaces.filter(w => w.id !== id);
                this.state.posts = this.state.posts.filter(p => p.workspaceId !== id);
                if (this.state.currentWorkspace === id && this.state.workspaces.length > 0) {
                    this.state.currentWorkspace = this.state.workspaces[0].id;
                }
                this.saveToStorage();
            }

            getPostsByWorkspace(workspaceId) {
                return this.state.posts.filter(p => p.workspaceId === workspaceId);
            }

            addPost(post) {
                post.id = 'p' + Date.now();
                post.createdAt = new Date().toISOString();
                this.state.posts.push(post);
                this.saveToStorage();
                return post;
            }

            updatePost(id, updates) {
                const index = this.state.posts.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.state.posts[index] = { ...this.state.posts[index], ...updates };
                    this.saveToStorage();
                }
            }

            deletePost(id) {
                this.state.posts = this.state.posts.filter(p => p.id !== id);
                this.saveToStorage();
            }

            addActivity(activity) {
                activity.id = 'a' + Date.now();
                activity.time = 'Just now';
                this.state.activities.unshift(activity);
                if (this.state.activities.length > 10) this.state.activities.pop();
                this.saveToStorage();
            }

            toggleDarkMode() {
                this.state.darkMode = !this.state.darkMode;
                document.documentElement.classList.toggle('dark', this.state.darkMode);
                this.saveToStorage();
            }

            setUser(user) {
                this.state.user = user;
                this.saveToStorage();
            }

            logout() {
                this.state.user = null;
                this.saveToStorage();
            }

            addMedia(mediaItem) {
                if (!this.state.mediaLibrary) this.state.mediaLibrary = [];

                // Enforce 50 items limit per workspace
                const workspaceId = this.state.currentWorkspace;
                const workspaceMedia = this.state.mediaLibrary.filter(m => m.workspaceId === workspaceId);

                if (workspaceMedia.length >= 50) {
                    throw new Error('Storage limit reached (max 50 items). Please delete some images.');
                }

                mediaItem.id = 'm' + Date.now();
                mediaItem.createdAt = new Date().toISOString();
                mediaItem.workspaceId = workspaceId;

                this.state.mediaLibrary.unshift(mediaItem);
                this.saveToStorage();
                return mediaItem;
            }

            getMediaByWorkspace(workspaceId) {
                if (!this.state.mediaLibrary) return [];
                return this.state.mediaLibrary.filter(m => m.workspaceId === workspaceId);
            }

            deleteMedia(id) {
                if (!this.state.mediaLibrary) return;
                this.state.mediaLibrary = this.state.mediaLibrary.filter(m => m.id !== id);
                this.saveToStorage();
            }
        }

        const store = new Store();

        // ==================== ROUTER ====================
        class Router {
            constructor() {
                this.routes = {};
                this.currentRoute = null;
                window.addEventListener('hashchange', () => this.handleRoute());
                window.addEventListener('load', () => this.handleRoute());
            }

            register(path, handler) {
                this.routes[path] = handler;
            }

            navigate(path) {
                window.location.hash = path;
            }

            handleRoute() {
                const hash = window.location.hash.slice(1) || '/';
                const [path, ...params] = hash.split('/').filter(Boolean);
                const route = '/' + (path || '');

                this.currentRoute = route;

                if (this.routes[route]) {
                    this.routes[route](params);
                } else if (this.routes['*']) {
                    this.routes['*']();
                }
            }
        }

        const router = new Router();

        // ==================== UTILITIES ====================
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), duration);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatTime(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        function getPlatformIcon(platform) {
            const icons = {
                linkedin: '<div class="platform-icon platform-linkedin">in</div>',
                twitter: '<div class="platform-icon platform-twitter">ð•</div>',
                facebook: '<div class="platform-icon platform-facebook">f</div>',
                instagram: '<div class="platform-icon platform-instagram">ig</div>'
            };
            return icons[platform] || '';
        }

        // ==================== AI CONTENT GENERATION ====================
        const AIAgents = {
            viral: {
                name: 'Viral Momentum Architect',
                strategy: 'High-hook, shareable content',
                generate: (topic, tone) => {
                    const hooks = ['ðŸš€ This changes everything:', 'ðŸ’¡ Hot take:', 'ðŸ”¥ You need to see this:', 'âš¡ Breaking:'];
                    const hook = hooks[Math.floor(Math.random() * hooks.length)];
                    return `${hook} ${topic}\n\nThis is the future of innovation. Don't miss out!\n\n#viral #trending #innovation`;
                }
            },
            community: {
                name: 'Community Engagement Catalyst',
                strategy: 'Conversation starters',
                generate: (topic, tone) => {
                    return `Let's talk about ${topic}.\n\nWhat's your experience with this? I'd love to hear your thoughts in the comments below! ðŸ‘‡\n\n#community #discussion #engagement`;
                }
            },
            algorithmic: {
                name: 'Algorithmic Outreach Strategist',
                strategy: 'SEO & keyword optimized',
                generate: (topic, tone) => {
                    return `${topic} - A comprehensive guide\n\nKey insights:\nâ€¢ Strategy optimization\nâ€¢ Best practices\nâ€¢ Industry trends\n\nLearn more about digital transformation and growth strategies.\n\n#SEO #marketing #strategy #growth`;
                }
            },
            curator: {
                name: 'Chief Content Curator',
                strategy: 'Best of all agents',
                generate: (topic, tone, variants) => {
                    return `${topic}\n\nCombining the best insights from our research:\nâœ“ Engaging hooks that capture attention\nâœ“ Community-driven conversation\nâœ“ Strategic keyword optimization\n\nJoin the discussion and share your thoughts!\n\n#innovation #community #growth`;
                }
            }
        };

        function generateAIContent(topic, tone, platforms) {
            return new Promise((resolve, reject) => {
                // Check if user has credits before generating
                const workspace = store.getCurrentWorkspace();
                if (workspace && (!workspace.aiCredits || workspace.aiCredits <= 0)) {
                    showOutOfCreditsModal();
                    reject(new Error('Out of credits'));
                    return;
                }

                // Decrement credit for this generation
                if (workspace && workspace.aiCredits) {
                    workspace.aiCredits -= 1;
                    store.saveToStorage();
                }

                setTimeout(() => {
                    const variants = [
                        { agent: 'viral', content: AIAgents.viral.generate(topic, tone) },
                        { agent: 'community', content: AIAgents.community.generate(topic, tone) },
                        { agent: 'algorithmic', content: AIAgents.algorithmic.generate(topic, tone) },
                        { agent: 'curator', content: AIAgents.curator.generate(topic, tone) }
                    ];
                    resolve(variants);
                }, 2000);
            });
        }

        // ==================== COMPONENTS ====================
        function Sidebar() {
            const workspace = store.getCurrentWorkspace();
            const allWorkspaces = store.state.workspaces;
            return `
                <div class="sidebar">
                    <div style="padding: 1.5rem; border-bottom: 1px solid var(--border);">
                        <div style="cursor: pointer;" onclick="router.navigate('/dashboard')">
                            <img src="${APP_LOGO}" alt="Cydra" style="height: 48px; display: block; margin-bottom: 0.5rem;" />
                        </div>
                    </div>
                    
                    ${workspace ? `
                    <div style="padding: 1rem; border-bottom: 1px solid var(--border);">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">WORKSPACE</div>
                        <select class="input" style="font-weight: 600; padding: 0.5rem;" onchange="handleWorkspaceSwitch(this.value)">
                            ${allWorkspaces.map(ws => `
                                <option value="${ws.id}" ${ws.id === workspace.id ? 'selected' : ''}>${ws.name}</option>
                            `).join('')}
                        </select>
                        <button class="btn btn-ghost" style="width: 100%; margin-top: 0.5rem; font-size: 0.75rem; padding: 0.5rem;" onclick="router.navigate('/workspaces')">
                            Manage Workspaces
                        </button>
                    </div>
                    ` : ''}
                    
                    <nav style="padding: 1rem 0;">
                        <div class="nav-item ${router.currentRoute === '/' || router.currentRoute === '/dashboard' ? 'active' : ''}" onclick="router.navigate('/dashboard')">
                            <span>ðŸ“Š</span> Dashboard
                        </div>
                        <div class="nav-item ${router.currentRoute === '/create-post' ? 'active' : ''}" onclick="router.navigate('/create-post')">
                            <span>âœï¸</span> Create Post
                        </div>
                        <div class="nav-item ${router.currentRoute === '/content-library' ? 'active' : ''}" onclick="router.navigate('/content-library')">
                            <span>ðŸ“š</span> Content Library
                        </div>
                        <div class="nav-item ${router.currentRoute === '/media-library' ? 'active' : ''}" onclick="router.navigate('/media-library')">
                            <span>ðŸ–¼ï¸</span> Media Library
                        </div>
                        <div class="nav-item ${router.currentRoute === '/calendar' ? 'active' : ''}" onclick="router.navigate('/calendar')">
                            <span>ðŸ“…</span> Calendar
                        </div>
                        <div class="nav-item ${router.currentRoute === '/connected-accounts' ? 'active' : ''}" onclick="router.navigate('/connected-accounts')">
                            <span>ðŸ”—</span> Connected Accounts
                        </div>
                        <div class="nav-item ${router.currentRoute === '/workspace-settings' ? 'active' : ''}" onclick="router.navigate('/workspace-settings')">
                            <span>âš™ï¸</span> Current Workspace
                        </div>
                    </nav>
                    
                    <div style="position: absolute; bottom: 1rem; left: 0; right: 0; padding: 0 1rem;">
                        <div class="nav-item" onclick="store.toggleDarkMode(); renderApp();">
                            <span>${store.state.darkMode ? 'â˜€ï¸' : 'ðŸŒ™'}</span> ${store.state.darkMode ? 'Light' : 'Dark'} Mode
                        </div>
                        ${store.state.user ? `
                        <div class="nav-item" onclick="handleLogout()">
                            <span>ðŸšª</span> Logout
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function Header() {
            const workspace = store.getCurrentWorkspace();
            const credits = workspace?.aiCredits || 0;
            const planLimits = { solo: 50, team: 150, agency: 500 };
            const limit = planLimits[workspace?.plan] || 50;

            let badgeClass = 'credit-badge';
            if (credits <= 5) {
                badgeClass += ' critical';
            } else if (credits <= 15) {
                badgeClass += ' low';
            }

            return `
                <div class="header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="font-size: 1.25rem; font-weight: 600;">Welcome back!</h2>
                    ${workspace ? `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span class="${badgeClass}" title="Click to Top Up (Demo)" onclick="handleCreditTopUp(100)" style="cursor: pointer;">Credits: ${credits}/${limit}</span>
                        ${workspace.plan ? `<span style="font-size: 0.75rem; color: var(--text-secondary); padding: 0.25rem 0.5rem; background: var(--bg-tertiary); border-radius: 4px;">${workspace.plan.toUpperCase()} Plan</span>` : ''}
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // ==================== PAGES ====================
        function LoginPage() {
            return `
                <div class="auth-page">
                    <div class="auth-card compact">
                        <div class="auth-header compact">
                            <img src="${APP_LOGO}" alt="Cydra" style="height: 40px;">
                            <h2 class="auth-title">Welcome Back</h2>
                            <p class="auth-subtitle">Sign in to your dashboard</p>
                        </div>
                        
                        <!-- SSO Buttons Grid (AUTH-02) -->
                        <div class="sso-grid">
                            <button class="sso-btn google" type="button" onclick="handleSSOLogin('google')">
                                <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                Google
                            </button>
                            <button class="sso-btn meta" onclick="handleSSOLogin('meta')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                Meta
                            </button>
                            <button class="sso-btn linkedin" onclick="handleSSOLogin('linkedin')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="#0A66C2"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg>
                                LinkedIn
                            </button>
                            <button class="sso-btn twitter" onclick="handleSSOLogin('twitter')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                X
                            </button>
                        </div>
                        
                        <div class="sso-divider compact">
                            <span>or</span>
                        </div>
                        
                        <form onsubmit="handleLogin(event)" id="loginForm" class="compact-form">
                            <div class="form-row compact">
                                <label for="loginEmail">Email Address</label>
                                <div class="input-wrapper">
                                    <input type="email" id="loginEmail" class="input compact" placeholder="name@business.com" 
                                           oninput="validateLoginEmail(this)" required aria-describedby="loginError">
                                    <span class="input-icon" id="loginEmailIcon"></span>
                                </div>
                            </div>
                            
                            <div class="form-row compact">
                                <label for="loginPassword">Password</label>
                                <div class="input-wrapper">
                                    <input type="password" id="loginPassword" class="input compact" placeholder="Enter your password" required>
                                </div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="rememberMe">
                                    <span style="font-size: 0.75rem;">Keep me signed in</span>
                                </label>
                                <a class="auth-link" style="font-size: 0.75rem;" onclick="showForgotPassword()">Forgot Password?</a>
                            </div>
                            
                            <!-- AUTH-03: Generic error for security -->
                            <div id="loginError" class="validation-message error" style="display: none; margin-bottom: 0.75rem;" role="alert">
                                Invalid email or password.
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Sign In</button>
                            
                            <div style="text-align: center; margin-top: 1rem;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Don't have an account? </span>
                                <a class="auth-link" href="#/signup">Sign Up</a>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function SignupPage() {
            return `
                <div class="auth-page">
                    <div class="auth-card compact">
                        <div class="auth-header compact">
                            <img src="${APP_LOGO}" alt="Cydra" style="height: 40px;">
                            <h2 class="auth-title">Join Cydra</h2>
                            <p class="auth-subtitle">Start your free 7-day trial</p>
                        </div>
                        
                        <!-- SSO Buttons Grid (AUTH-02) -->
                        <div class="sso-grid">
                            <button class="sso-btn google" onclick="handleSSOSignup('google')">
                                <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                Google
                            </button>
                            <button class="sso-btn meta" onclick="handleSSOSignup('meta')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                Meta
                            </button>
                            <button class="sso-btn linkedin" onclick="handleSSOSignup('linkedin')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="#0A66C2"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg>
                                LinkedIn
                            </button>
                            <button class="sso-btn twitter" onclick="handleSSOSignup('twitter')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                X
                            </button>
                        </div>
                        
                        <div class="sso-divider compact">
                            <span>or</span>
                        </div>
                        
                        <form onsubmit="handleSignup(event)" id="signupForm" class="compact-form">
                            <div class="form-grid">
                                <div class="form-row compact">
                                    <label>Full Name</label>
                                    <div class="input-wrapper">
                                        <input type="text" id="signupName" class="input compact" placeholder="John Doe" 
                                               oninput="validateSignupName(this)" required>
                                        <span class="input-icon" id="signupNameIcon"></span>
                                    </div>
                                </div>
                                
                                <div class="form-row compact">
                                    <label for="signupEmail">Email Address</label>
                                    <div class="input-wrapper">
                                        <input type="email" id="signupEmail" class="input compact" placeholder="name@business.com" 
                                               oninput="validateSignupEmail(this)" required aria-describedby="signupPasswordMsg">
                                        <span class="input-icon" id="signupEmailIcon"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row compact">
                                <label for="signupPassword">Password</label>
                                <div class="input-wrapper">
                                    <input type="password" id="signupPassword" class="input compact" placeholder="Create a password" 
                                           oninput="validatePassword(this)" required minlength="8" maxlength="12" aria-describedby="signupPasswordMsg passwordStrength">
                                    <span class="input-icon" id="signupPasswordIcon"></span>
                                </div>
                                <p id="signupPasswordMsg" class="helper-text" style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">Must be 8-12 alphanumeric characters.</p>
                                <!-- AUTH-08: Real-time validation messages -->
                                <div class="password-strength" id="passwordStrength" style="display: none;">
                                    <div class="strength-bar">
                                        <div class="strength-fill" id="strengthFill"></div>
                                    </div>
                                    <div class="strength-text" id="strengthText">Password strength</div>
                                </div>
                            </div>
                            
                            <div class="form-row compact">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="agreeTerms" required aria-describedby="agreeTermsLabel">
                                    <span id="agreeTermsLabel" style="font-size: 0.75rem;">I agree to the <a class="auth-link" href="#/terms" target="_blank">Terms of Service</a></span>
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
                            
                            <div style="text-align: center; margin-top: 1rem;">
                                <span style="color: var(--text-secondary); font-size: 0.875rem;">Already have an account? </span>
                                <a class="auth-link" href="#/login">Sign In</a>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function DashboardPage() {
            const workspace = store.getCurrentWorkspace();
            const posts = store.getPostsByWorkspace(workspace.id);
            const stats = {
                drafts: posts.filter(p => p.status === 'draft').length,
                scheduled: posts.filter(p => p.status === 'scheduled').length,
                published: posts.filter(p => p.status === 'published').length,
                engagement: '12.5K'
            };

            return `
                ${Sidebar()}
                ${Header()}
                <div class="main-content">
                    ${!store.state.user?.emailVerified ? `
                    <!-- AUTH-04: Email Verification "Soft Gate" -->
                    <div class="verification-banner warning" id="verification-banner">
                        <div class="verification-content">
                            <span class="verification-icon">âš ï¸</span>
                            <div>
                                <strong>Email not verified</strong>
                                <p style="margin: 0; font-size: 0.875rem;">Please verify your email to start posting.</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="btn btn-primary" style="padding: 0.5rem 1rem;" onclick="resendVerificationEmail()">
                                Resend Verification Email
                            </button>
                            <button class="btn btn-ghost" style="padding: 0.5rem 1rem; border: 1px solid rgba(255,255,255,0.6); color: white;" onclick="demoVerifyEmail()" title="Demo: Simulate clicking the verification link">
                                Verify email (demo)
                            </button>
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="margin-bottom: 2rem;">
                        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Dashboard</h1>
                        <p style="color: var(--text-secondary);">Overview of your social media performance</p>
                    </div>
                    
                    <div class="grid-auto grid-4" style="margin-bottom: 2rem;">
                        <div class="card stat-card">
                            <div class="stat-value">${stats.drafts}</div>
                            <div class="stat-label">Drafts</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value">${stats.scheduled}</div>
                            <div class="stat-label">Scheduled</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value">${stats.published}</div>
                            <div class="stat-label">Published</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value">${stats.engagement}</div>
                            <div class="stat-label">Total Engagement</div>
                        </div>
                    </div>
                    
                    <div class="grid-auto grid-2">
                        <div class="card">
                            <h3 style="font-weight: 600; margin-bottom: 1rem;">Recent Activity</h3>
                            <div>
                                ${store.state.activities.map(activity => `
                                    <div class="activity-item">
                                        <div style="flex: 1;">
                                            <div style="font-weight: 500;">${activity.content}</div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">${activity.time}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 style="font-weight: 600; margin-bottom: 1rem;">Quick Actions</h3>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <button class="btn btn-primary" onclick="router.navigate('/create-post')">âœï¸ Create New Post</button>
                                <button class="btn btn-secondary" onclick="router.navigate('/calendar')">ðŸ“… View Calendar</button>
                                <button class="btn btn-ghost" onclick="handleManageSubscription()">ðŸ’³ Manage Subscription</button>
                                <button class="btn btn-ghost" onclick="router.navigate('/workspace-settings')">âš™ï¸ Workspace Settings</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function AdminDashboardPage() {
            // Mock Users for OPS-P1-01/02
            const users = [
                { id: 'u1', name: 'Demo User', email: 'user@demo.com', plan: 'solo', workspaces: 1 },
                { id: 'u2', name: 'Agency Pro', email: 'pro@agency.com', plan: 'agency', workspaces: 3 },
                { id: 'u3', name: 'Team Lead', email: 'lead@team.com', plan: 'team', workspaces: 1 }
            ];

            return `
                ${Sidebar()}
                ${Header()}
                <div class="main-content">
                    <div style="margin-bottom: 2rem;">
                        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">âš™ï¸ Admin Console</h1>
                        <p style="color: var(--text-secondary);">System operations and user management</p>
                    </div>

                    <div class="card">
                        <h3 style="font-weight: 600; margin-bottom: 1.5rem;">User Lookup (OPS-P1-01)</h3>
                        <div style="margin-bottom: 1.5rem;">
                            <input type="text" class="input" placeholder="Search users by name or email..." style="max-width: 400px;">
                        </div>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="text-align: left; border-bottom: 1px solid var(--border);">
                                        <th style="padding: 1rem;">User</th>
                                        <th style="padding: 1rem;">Plan</th>
                                        <th style="padding: 1rem;">Workspaces</th>
                                        <th style="padding: 1rem;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${users.map(user => `
                                        <tr style="border-bottom: 1px solid var(--border);">
                                            <td style="padding: 1rem;">
                                                <div style="font-weight: 600;">${user.name}</div>
                                                <div style="font-size: 0.8rem; color: var(--text-secondary);">${user.email}</div>
                                            </td>
                                            <td style="padding: 1rem;">
                                                <span class="badge" style="background: #E0E7FF; color: #4338CA; text-transform: uppercase;">${user.plan}</span>
                                            </td>
                                            <td style="padding: 1rem;">${user.workspaces}</td>
                                            <td style="padding: 1rem;">
                                                <button class="btn btn-secondary" onclick="impersonateUser('${user.email}', '${user.name}', '${user.plan}')">
                                                    Login as User
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function impersonateUser(email, name, plan) {
            // OPS-P1-02: Impersonation
            if (confirm(`Login as ${name}? (Impersonation Mode)`)) {
                store.logout(); // Clear current session
                store.setUser({
                    email: email,
                    name: name,
                    emailVerified: true
                });
                showToast(`ðŸ‘» Impersonating ${name}...`);
                setTimeout(() => router.navigate('/dashboard'), 500);
            }
        }

        function CreatePostPage() {
            return `
                ${Sidebar()}
                ${Header()}
                <div class="main-content">
                    <div style="margin-bottom: 2rem;">
                        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Create New Post</h1>
                        <p style="color: var(--text-secondary);">Generate AI-powered content for your social media</p>
                    </div>
                    
                    <div class="card" style="margin-bottom: 2rem;">
                        <h3 style="font-weight: 600; margin-bottom: 1rem;">Select Platforms</h3>
                        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.75rem;">Select at least one (LinkedIn or X). Selection sets the character limit.</p>
                        <div class="grid-auto grid-4" id="platformGrid">
                            ${['linkedin', 'twitter', 'facebook', 'instagram'].map(platform => `
                                <div class="platform-card ${selectedPlatforms.includes(platform) ? 'selected' : ''}" 
                                     onclick="togglePlatform('${platform}')" data-platform="${platform}">
                                    ${getPlatformIcon(platform)}
                                    <div style="margin-top: 1rem; font-weight: 600; text-transform: capitalize;">${platform}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="card" style="margin-bottom: 2rem;">
                        <h3 style="font-weight: 600; margin-bottom: 1rem;">Content Details</h3>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="topicInput" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Topic / Idea</label>
                            <textarea id="topicInput" class="input" rows="4" placeholder="e.g., 3 tips for remote leadership" maxlength="500"></textarea>
                            <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">Max 500 characters. Used as the primary prompt for AI.</p>
                        </div>
                        
                        <div class="grid-auto grid-2" style="margin-bottom: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Tone</label>
                                <select id="toneSelect" class="input">
                                    <option>Professional</option>
                                    <option>Casual</option>
                                    <option>Witty</option>
                                    <option>Controversial</option>
                                    <option>Urgent</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Keywords/Hashtags</label>
                                <input type="text" id="keywordsInput" class="input" placeholder="#marketing #growth">
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="handleGenerateContent()">Generate with AI</button>
                            <span style="font-size: 0.875rem; color: var(--text-secondary);">Credits: <strong id="createPostCredits">${(store.getCurrentWorkspace()?.aiCredits || 0)}/${(store.getCurrentWorkspace()?.plan ? { solo: 50, team: 150, agency: 500 }[store.getCurrentWorkspace().plan] : 50)}</strong></span>
                        </div>
                    </div>
                    
                    <div id="aiOutput" class="hidden">
                        <!-- Populated by handleGenerateContent -->
                    </div>
                    
                    <div id="editorSection" class="hidden">
                        <div class="card" style="margin-top: 2rem;">
                            <h3 style="font-weight: 600; margin-bottom: 1rem;">Edit & Publish</h3>
                            
                            <div style="position: relative;">
                                <label for="finalContent" style="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;">Post Content</label>
                                <textarea id="finalContent" class="input" rows="8" placeholder="What do you want to share?" 
                                    oninput="updateCharacterCount(this); startAutoSaveTimer();" onpaste="handlePostContentPaste(event)"
                                    aria-describedby="charCount"></textarea>
                                <div id="charCount" style="text-align: right; font-size: 0.8rem; margin-top: 0.25rem;" role="status">0 / 280</div>
                            </div>

                            <div style="margin-top: 1rem;">
                                <!-- CONT-03: Image Handling -->
                                <input type="file" id="mediaUpload" style="display: none;" accept="image/jpeg, image/png" onchange="handleMediaUpload(this)">
                                <button class="btn btn-secondary" onclick="openMediaModal()">ðŸ“· Add Media</button>
                                
                                <div id="mediaPreview" style="display: none; margin-top: 1rem; border: 1px solid var(--border); padding: 0.5rem; border-radius: 0.5rem; width: fit-content; background: var(--bg-card);">
                                    <div style="position: relative;">
                                        <img id="previewImage" src="" style="max-width: 200px; max-height: 200px; border-radius: 4px; object-fit: cover;">
                                        <button onclick="removeMedia()" style="position: absolute; top: -10px; right: -10px; background: #EF4444; color: white; border: 2px solid white; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: var(--shadow-md);">Ã—</button>
                                    </div>
                                    <label for="altText" style="font-size: 0.75rem; color: var(--text-secondary);">Alt Text</label>
                                    <input type="text" id="altText" class="input" placeholder="Describe this image..." maxlength="1000" style="margin-top: 0.25rem; width: 100%; font-size: 0.8rem;">
                                </div>
                                <span id="uploadStatus" style="font-size: 0.875rem; color: var(--text-secondary); margin-left: 0.5rem;"></span>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                                <button class="btn btn-ghost" onclick="handleSaveDraft()">Save Draft</button>
                                <button class="btn btn-secondary" onclick="showScheduleModal()">Schedule</button>
                                <button class="btn btn-primary" onclick="handlePublishNow()">Publish Now</button>
                            </div>
                            <div id="autoSaveIndicator" style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem; font-style: italic;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Schedule Modal (SCHED-01) -->
                <div id="scheduleModal" class="modal">
                    <div class="modal-content">
                        <h3 style="font-weight: 600; margin-bottom: 1.5rem;">Schedule Publication</h3>
                        <p id="scheduleTimezoneLabel" style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">Scheduling in <span id="scheduleTimezoneValue">â€”</span></p>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="scheduleDate" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Date</label>
                            <input type="date" id="scheduleDate" class="input" aria-describedby="scheduleError">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="scheduleTime" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Time</label>
                            <input type="time" id="scheduleTime" class="input" aria-describedby="scheduleError">
                        </div>
                        <div id="scheduleError" class="validation-message error" style="display: none; margin-bottom: 1rem;" role="alert"></div>
                        <p id="scheduleHelper" style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 1.5rem;"></p>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-ghost" onclick="closeScheduleModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="handleSchedule()">Confirm Schedule</button>
                        </div>
                    </div>
                </div>
                
                <!-- Media Selection Modal -->
                <div id="mediaModal" class="modal">
                    <div class="modal-content" style="max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
                        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="font-weight: 600;">Select Media</h3>
                            <button onclick="closeMediaModal()" class="btn btn-ghost" style="padding: 0.25rem 0.5rem; font-size: 1.5rem;">Ã—</button>
                        </div>
                        
                        <div class="tabs" style="display: flex; gap: 1rem; border-bottom: 1px solid var(--border); margin-bottom: 1rem;">
                            <button class="tab-btn active" id="tab-upload" onclick="switchMediaTab('upload')" style="padding: 0.5rem 1rem; cursor: pointer; border: none; background: none; border-bottom: 2px solid transparent;">Upload New</button>
                            <button class="tab-btn" id="tab-library" onclick="switchMediaTab('library')" style="padding: 0.5rem 1rem; cursor: pointer; border: none; background: none; border-bottom: 2px solid transparent;">Select from Library</button>
                        </div>
                        
                        <style>
                            .tab-btn.active {
                                border-bottom-color: var(--primary) !important;
                                color: var(--primary);
                                font-weight: 600;
                            }
                        </style>

                        <div id="media-tab-content-upload" class="tab-content" style="flex: 1;">
                            <div style="border: 2px dashed var(--border); border-radius: 0.5rem; padding: 3rem; text-align: center; cursor: pointer;" onclick="document.getElementById('modalFileUpload').click()">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">â˜ï¸</div>
                                <h3>Click to Upload</h3>
                                <p style="color: var(--text-secondary);">JPG, PNG (Max 5MB)</p>
                                <input type="file" id="modalFileUpload" accept="image/jpeg, image/png" style="display: none;" onchange="handleModalUpload(this)">
                            </div>
                        </div>

                        <div id="media-tab-content-library" class="tab-content" style="display: none; flex: 1; overflow-y: auto;">
                             <div class="media-grid-select" id="mediaGridSelect" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem;">
                                <!-- Populated by JS -->
                             </div>
                        </div>

                        <div class="modal-footer" style="margin-top: 1rem; display: flex; justify-content: flex-end; gap: 1rem;">
                             <button class="btn btn-ghost" onclick="closeMediaModal()">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function ContentLibraryPage() {
            const workspace = store.getCurrentWorkspace();
            const posts = store.getPostsByWorkspace(workspace.id);

            return `
                ${Sidebar()}
                ${Header()}
                <div class="main-content">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Content Library</h1>
                            <p style="color: var(--text-secondary);">Manage and organize your social media posts</p>
                        </div>
                        <button class="btn btn-primary" onclick="router.navigate('/create-post')">âœï¸ Create Post</button>
                    </div>
                    
                    <div class="card" style="margin-bottom: 2rem;">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <input type="text" id="searchInput" class="input" placeholder="ðŸ” Search posts..." style="flex: 1; min-width: 200px;" oninput="filterPosts()">
                            <select id="statusFilter" class="input" style="width: 150px;" onchange="filterPosts()">
                                <option value="">All Status</option>
                                <option value="draft">Draft</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="card">
                        <table class="content-table">
                            <thead>
                                <tr>
                                    <th>Content</th>
                                    <th>Status</th>
                                    <th>Platforms</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="postsTableBody">
                                ${posts.map(post => `
                                    <tr data-post-id="${post.id}" data-status="${post.status}">
                                        <td>
                                            <div style="max-width: 400px;">
                                                ${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge badge-${post.status}">${post.status}</span>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 0.25rem;">
                                                ${post.platforms.map(p => getPlatformIcon(p)).join('')}
                                            </div>
                                        </td>
                                        <td>
                                            <div>${formatDate(post.date)}</div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">${formatTime(post.date)}</div>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button class="btn btn-ghost" style="padding: 0.5rem;" onclick="editPost('${post.id}')">âœï¸</button>
                                                <button class="btn btn-ghost" style="padding: 0.5rem;" onclick="deletePost('${post.id}')">ðŸ—‘ï¸</button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ==================== MEDIA LIBRARY (New) ====================
        function MediaLibraryPage() {
            const workspace = store.getCurrentWorkspace();
            const media = store.getMediaByWorkspace(workspace.id);

            return `
                ${Sidebar()}
                ${Header()}
                <div class="main-content">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Media Library</h1>
                            <p style="color: var(--text-secondary);">Manage your brand assets and images</p>
                        </div>
                        <div>
                            <input type="file" id="bulkUploadInput" multiple accept="image/jpeg, image/png" style="display: none;" onchange="handleBulkUpload(this)">
                            <button class="btn btn-primary" onclick="document.getElementById('bulkUploadInput').click()">â˜ï¸ Upload Asset</button>
                        </div>
                    </div>

                    <!-- Library Grid -->
                    ${media.length === 0 ? `
                        <div class="card" style="text-align: center; padding: 4rem 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ–¼ï¸</div>
                            <h3 style="font-weight: 600; margin-bottom: 0.5rem;">No assets yet</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Upload your first image to get started.</p>
                            <button class="btn btn-secondary" onclick="document.getElementById('bulkUploadInput').click()">Upload Asset</button>
                        </div>
                    ` : `
                        <div class="card">
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                                ${media.map(item => `
                                    <div class="media-item" style="border: 1px solid var(--border); border-radius: 0.5rem; overflow: hidden; position: relative;">
                                        <div style="height: 150px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                            <img src="${item.dataUrl}" alt="${item.name}" loading="lazy" style="width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                        <div style="padding: 0.75rem;">
                                            <div style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 0.25rem;" title="${item.name}">${item.name}</div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary); display: flex; justify-content: space-between; align-items: center;">
                                                <span>${formatBytes(item.size)}</span>
                                                <button style="color: #EF4444; cursor: pointer; background: none; border: none; font-size: 0.75rem;" onclick="deleteMediaAsset('${item.id}')">Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `}
                </div>
            `;
        }

        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        function handleBulkUpload(input) {
            if (!input.files || input.files.length === 0) return;

            Array.from(input.files).forEach(file => {
                // Validation
                const validTypes = ['image/jpeg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    showToast(`Skipped ${file.name}: Invalid format (only JPG/PNG)`);
                    return;
                }
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`Skipped ${file.name}: Too large (>5MB)`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        store.addMedia({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            dataUrl: e.target.result
                        });
                        showToast(`Uploaded ${file.name}`);
                        // Refresh if on media library page
                        if (router.currentRoute === '/media-library') {
                            renderApp(MediaLibraryPage());
                        }
                    } catch (err) {
                        showToast(err.message);
                    }
                };
                reader.readAsDataURL(file);
            });
            input.value = ''; // Reset
        }

        function deleteMediaAsset(id) {
            if (confirm('Are you sure you want to delete this asset?')) {
                store.deleteMedia(id);
                showToast('Asset deleted');
                renderApp(MediaLibraryPage());
            }
        }

        // ==================== MEDIA MODAL HELPERS ====================
        function openMediaModal() {
            const modal = document.getElementById('mediaModal');
            if (modal) {
                modal.classList.add('active');
                switchMediaTab('upload'); // Default tab
            }
        }

        function closeMediaModal() {
            const modal = document.getElementById('mediaModal');
            if (modal) modal.classList.remove('active');
        }

        function switchMediaTab(tab) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById(`tab-${tab}`);
            if (btn) btn.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            const content = document.getElementById(`media-tab-content-${tab}`);
            if (content) content.style.display = 'block';

            if (tab === 'library') {
                renderMediaModalGrid();
            }
        }

        function renderMediaModalGrid() {
            const container = document.getElementById('mediaGridSelect');
            if (!container) return;

            const workspace = store.getCurrentWorkspace();
            const media = store.getMediaByWorkspace(workspace.id);

            if (media.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-secondary); padding: 2rem;">No media found. Upload some first!</div>';
                return;
            }

            container.innerHTML = media.map(item => `
                <div class="media-item-select" style="cursor: pointer; border: 2px solid transparent; border-radius: 4px; overflow: hidden;" onclick="selectMediaFromLibrary('${item.dataUrl}')">
                    <div style="height: 100px; background: #f3f4f6;">
                        <img src="${item.dataUrl}" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div style="font-size: 0.75rem; padding: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.name}</div>
                </div>
            `).join('');
        }

        function selectMediaFromLibrary(dataUrl) {
            // Reuse existing preview logic
            const preview = document.getElementById('mediaPreview');
            const previewImg = document.getElementById('previewImage');

            if (previewImg) previewImg.src = dataUrl;
            if (preview) preview.style.display = 'block';

            showToast('Image selected from library');
            closeMediaModal();
        }

        function handleModalUpload(input) {
            handleMediaUpload(input);
            closeMediaModal();
        }

        let calendarDate = new Date();

        function changeMonth(offset) {
            calendarDate.setMonth(calendarDate.getMonth() + offset);
            renderApp(CalendarPage());
        }

        function CalendarPage() {
            const workspace = store.getCurrentWorkspace();
            const posts = workspace ? store.getPostsByWorkspace(workspace.id) : [];

            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

            let calendarDays = '';
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            dayNames.forEach(day => {
                calendarDays += `<div style="text-align: center; font-weight: 600; padding: 0.5rem; color: var(--text-secondary); background: var(--bg-app);">${day}</div>`;
            });

            for (let i = 0; i < firstDay; i++) {
                calendarDays += '<div></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayPosts = posts.filter(p => p.date && p.date.startsWith(dateStr));

                calendarDays += `
                    <div class="calendar-day">
                        <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text-secondary);">${day}</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            ${dayPosts.map(post => `
                                <div style="background: ${post.status === 'published' ? '#D1FAE5' : '#E0E7FF'}; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; color: ${post.status === 'published' ? '#065F46' : '#4338CA'}; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer;">
                                    ${post.content || 'Untitled Post'}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            return `
                ${Sidebar()}
                ${Header()}
                <div class="main-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div>
                            <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">ðŸ“… Content Calendar</h1>
                            <p style="color: var(--text-secondary);">Schedule and visualize your content</p>
                        </div>
                        <button class="btn btn-primary" onclick="router.navigate('/create-post')">âœï¸ Create Post</button>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <button class="btn btn-ghost" onclick="changeMonth(-1)">â† Previous</button>
                            <h2 style="font-size: 1.5rem; font-weight: 600;">${monthNames[month]} ${year}</h2>
                            <button class="btn btn-ghost" onclick="changeMonth(1)">Next â†’</button>
                        </div>
                        
                        <div class="calendar-grid">
                            ${calendarDays}
                        </div>
                    </div>
                </div>
            `;
        }


        // Onboarding state management
        let onboardingStep = 1;
        let onboardingData = {
            workspaceName: '',
            slug: '',
            industry: '',
            companySize: '',
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC',
            logo: null,
            description: '',
            website: '',
            primaryGoal: '',
            selectedPlan: 'solo'
        };

        // Generate slug from workspace name (ONB-01)
        function generateSlug(name) {
            return name.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .substring(0, 30);
        }

        // Update workspace slug in real-time (ONB-01)
        function updateWorkspaceSlug() {
            const nameInput = document.getElementById('workspaceName');
            const slugInput = document.getElementById('workspaceSlug');
            const slugPreview = document.getElementById('slugPreview');

            if (nameInput && slugInput) {
                const generatedSlug = generateSlug(nameInput.value);
                slugInput.value = generatedSlug;
                onboardingData.workspaceName = nameInput.value;
                onboardingData.slug = generatedSlug;

                if (slugPreview) {
                    slugPreview.textContent = generatedSlug ? `cydra.social/${generatedSlug}` : 'cydra.social/your-workspace';
                }
            }
            updateOnboardingCompleteness();
        }

        // ONB-02: Slug validation â€” hardcoded "taken" list + 3 suggestions (wishtree1, wishtree-hq, wishtree-official)
        const TAKEN_SLUGS_DEMO = ['acme', 'wishtree', 'cydra', 'demo', 'social'];
        let slugCheckTimeout = null;
        function debounceSlugCheck() {
            if (slugCheckTimeout) clearTimeout(slugCheckTimeout);
            slugCheckTimeout = setTimeout(validateSlugUniqueness, 500);
        }
        function validateSlugUniqueness() {
            const slugInput = document.getElementById('workspaceSlug');
            const indicator = document.getElementById('slugAvailability');
            if (!slugInput || !indicator) return;
            const slug = slugInput.value.trim().toLowerCase();

            if (!slug) {
                indicator.innerHTML = '';
                return;
            }

            const existingSlugs = store.state.workspaces.map(w => (w.slug || '').toLowerCase());
            const allTaken = [...new Set([...TAKEN_SLUGS_DEMO, ...existingSlugs])];
            const isAvailable = !allTaken.includes(slug);

            if (isAvailable) {
                indicator.innerHTML = '<span style="color: #10B981; font-weight: 500;">âœ“ Available</span>';
            } else {
                const base = slug.replace(/-/g, '');
                const suggestions = [
                    base + '1',
                    base + '-hq',
                    base + '-official'
                ].filter(s => s.length <= 30 && !allTaken.includes(s)).slice(0, 3);

                indicator.innerHTML = `
                    <div style="color: #DC2626; margin-bottom: 0.5rem; font-weight: 500;">That URL is already taken.</div>
                    ${suggestions.length ? `
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            Try: ${suggestions.map(s =>
                    `<span class="slug-suggestion" onclick="var i=document.getElementById('workspaceSlug'); i.value='${s}'; validateSlugUniqueness(); updateOnboardingCompleteness();" style="color: var(--primary); cursor: pointer; text-decoration: underline; margin-right: 0.5rem;">${s}</span>`
                ).join('')}
                        </div>
                    ` : ''}
                `;
            }
        }

        // Handle logo upload (ONB-03)
        function handleLogoUpload(input) {
            const file = input.files[0];
            const preview = document.getElementById('logoPreview');
            const placeholder = document.getElementById('logoPlaceholder');

            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showToast('Please upload an image file');
                    return;
                }

                // Validate file size (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showToast('Logo must be smaller than 2MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    onboardingData.logo = e.target.result;
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    updateOnboardingCompleteness();
                };
                reader.readAsDataURL(file);
            }
        }

        // Calculate and update onboarding completeness (ONB-04, ONB-06)
        function updateOnboardingCompleteness() {
            const fields = {
                workspaceName: onboardingData.workspaceName?.length >= 2,
                slug: onboardingData.slug?.length >= 2,
                industry: !!document.getElementById('industry')?.value,
                companySize: !!document.getElementById('companySize')?.value,
                timezone: !!onboardingData.timezone,
                logo: !!onboardingData.logo,
                description: !!document.getElementById('description')?.value,
                website: !!document.getElementById('website')?.value
            };

            const required = ['workspaceName', 'slug', 'industry'];
            const optional = ['companySize', 'timezone', 'logo', 'description', 'website'];

            const requiredComplete = required.filter(f => fields[f]).length;
            const optionalComplete = optional.filter(f => fields[f]).length;

            const totalScore = (requiredComplete / required.length) * 70 + (optionalComplete / optional.length) * 30;

            const progressBar = document.getElementById('onboardingProgress');
            const progressText = document.getElementById('onboardingProgressText');

            if (progressBar) {
                progressBar.style.width = `${Math.round(totalScore)}%`;
            }
            if (progressText) {
                progressText.textContent = `${Math.round(totalScore)}% complete`;
            }
        }

        // Navigate onboarding steps
        function nextOnboardingStep() {
            if (onboardingStep === 1) {
                // Validate step 1
                const name = document.getElementById('workspaceName').value;
                const slug = document.getElementById('workspaceSlug').value;
                const industry = document.getElementById('industry').value;

                if (!name || name.length < 2) {
                    showToast('Please enter a workspace name');
                    return;
                }
                if (!slug || slug.length < 2) {
                    showToast('Please enter a valid slug');
                    return;
                }
                if (!industry) {
                    showToast('Please select an industry');
                    return;
                }

                onboardingData.workspaceName = name;
                onboardingData.slug = slug;
                onboardingData.industry = industry;
                onboardingData.companySize = document.getElementById('companySize').value;
            } else if (onboardingStep === 2) {
                onboardingData.timezone = document.getElementById('timezone').value;
                onboardingData.description = document.getElementById('description').value;
                onboardingData.targetAudience = document.getElementById('targetAudience')?.value || '';
                onboardingData.brandTone = document.getElementById('brandTone')?.value || '';
                onboardingData.website = document.getElementById('website').value;
                onboardingData.primaryGoal = document.getElementById('primaryGoal')?.value || '';
            }

            onboardingStep++;
            renderApp(OnboardingPage());
        }

        function prevOnboardingStep() {
            if (onboardingStep > 1) {
                onboardingStep--;
                renderApp(OnboardingPage());
            }
        }

        // Complete onboarding (ONB-05: Onboarding Completion & Subscription Handoff)
        function completeOnboarding() {
            // Create workspace with all collected data (status: pending subscription)
            const workspace = {
                name: onboardingData.workspaceName || 'My Workspace',
                slug: onboardingData.slug || 'my-workspace',
                industry: onboardingData.industry,
                companySize: onboardingData.companySize,
                timezone: onboardingData.timezone,
                logo: onboardingData.logo,
                description: onboardingData.description,
                targetAudience: onboardingData.targetAudience,
                brandTone: onboardingData.brandTone,
                website: onboardingData.website,
                primaryGoal: onboardingData.primaryGoal,
                plan: null,
                subscriptionStatus: 'pending',
                onboardingComplete: true,
                completeness: 100
            };

            const newWorkspace = store.addWorkspace(workspace);
            store.switchWorkspace(newWorkspace.id);

            // Reset onboarding state
            onboardingStep = 1;
            onboardingData = {
                workspaceName: '',
                slug: '',
                industry: '',
                companySize: '',
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC',
                logo: null,
                description: '',
                website: '',
                primaryGoal: '',
                selectedPlan: 'solo'
            };

            showToast('âœ“ Workspace created! Now select your plan.');

            // ONB-05: Redirect to Plan Selection page
            // Check if plan was pre-selected from public site (WEB-03)
            const preSelectedPlan = localStorage.getItem('preSelectedPlan');
            if (preSelectedPlan) {
                // Scenario A: Plan pre-selected, go directly to checkout page
                localStorage.removeItem('preSelectedPlan');
                router.navigate('/checkout/' + preSelectedPlan);
            } else {
                // Scenario B: No plan pre-selected, show Plan Selection screen
                router.navigate('/select-plan');
            }
        }

        function OnboardingPage() {
            const timezones = [
                'America/New_York', 'America/Chicago', 'America/Denver', 'America/Los_Angeles',
                'America/Anchorage', 'Pacific/Honolulu', 'Europe/London', 'Europe/Paris',
                'Europe/Berlin', 'Asia/Tokyo', 'Asia/Shanghai', 'Asia/Singapore',
                'Asia/Kolkata', 'Australia/Sydney', 'Pacific/Auckland', 'UTC'
            ];

            return `
                <div class="onboarding-page">
                    <div class="onboarding-container">
                        <div class="onboarding-header">
                            <img src="${APP_LOGO}" alt="Cydra" style="height: 50px; margin-bottom: 1rem;">
                            <h2 class="onboarding-title">Let's get you started</h2>
                            <p class="onboarding-subtitle">Set up your workspace in a few easy steps</p>
                        </div>
                        
                        <!-- Progress Indicator (ONB-04) -->
                        <div class="onboarding-progress-container">
                            <div class="onboarding-steps">
                                <div class="onboarding-step ${onboardingStep >= 1 ? 'active' : ''} ${onboardingStep > 1 ? 'completed' : ''}">
                                    <div class="step-number">1</div>
                                    <span>Basics</span>
                                </div>
                                <div class="step-connector ${onboardingStep > 1 ? 'completed' : ''}"></div>
                                <div class="onboarding-step ${onboardingStep >= 2 ? 'active' : ''} ${onboardingStep > 2 ? 'completed' : ''}">
                                    <div class="step-number">2</div>
                                    <span>Details</span>
                                </div>
                                <div class="step-connector ${onboardingStep > 2 ? 'completed' : ''}"></div>
                                <div class="onboarding-step ${onboardingStep >= 3 ? 'active' : ''}">
                                    <div class="step-number">3</div>
                                    <span>Branding</span>
                                </div>
                            </div>
                            
                            <!-- Completeness Meter (ONB-06) -->
                            <div class="completeness-meter">
                                <div class="completeness-bar">
                                    <div class="completeness-fill" id="onboardingProgress" style="width: ${onboardingStep === 1 ? '0' : onboardingStep === 2 ? '40' : '75'}%;"></div>
                                </div>
                                <span class="completeness-text" id="onboardingProgressText">${onboardingStep === 1 ? '0' : onboardingStep === 2 ? '40' : '75'}% complete</span>
                            </div>
                        </div>
                        
                        <div class="onboarding-content">
                            ${onboardingStep === 1 ? `
                                <!-- Step 1: Workspace Basics (ONB-01, ONB-07) -->
                                <div class="form-row">
                                    <label for="workspaceName">Workspace Name <span class="required">*</span></label>
                                    <input type="text" id="workspaceName" class="input" 
                                           placeholder="e.g., Acme Agency" 
                                           value="${onboardingData.workspaceName}"
                                           maxlength="50"
                                           oninput="updateWorkspaceSlug()" required aria-describedby="workspaceNameHelp">
                                    <div class="form-help" id="workspaceNameHelp">Your business or brand name.</div>
                                </div>
                                
                                <div class="form-row">
                                    <label for="workspaceSlug">Workspace URL <span class="required">*</span></label>
                                    <div class="slug-input-group">
                                        <span class="slug-prefix">cydra.social/</span>
                                        <input type="text" id="workspaceSlug" class="input slug-input" 
                                               placeholder="letters, numbers, and dashes only"
                                               value="${onboardingData.slug}"
                                               maxlength="30"
                                               oninput="debounceSlugCheck(); updateOnboardingCompleteness();" 
                                               onblur="validateSlugUniqueness()" required aria-describedby="slugAvailability slugPreview">
                                    </div>
                                    <div class="slug-preview" id="slugPreview">${onboardingData.slug ? `cydra.social/${onboardingData.slug}` : 'cydra.social/your-workspace'}</div>
                                    <div class="form-help">letters, numbers, and dashes only.</div>
                                    <div id="slugAvailability" role="status"></div>
                                </div>
                                
                                <div class="grid-auto grid-2" style="gap: 1rem;">
                                <div class="form-row">
                                    <label for="industry">Industry / Niche <span class="required">*</span></label>
                                    <select id="industry" class="input" required aria-describedby="industryHelp">
                                        <option value="">Select industry...</option>
                                            <option ${onboardingData.industry === 'Marketing' ? 'selected' : ''}>Marketing</option>
                                            <option ${onboardingData.industry === 'Technology' ? 'selected' : ''}>Technology</option>
                                            <option ${onboardingData.industry === 'Real Estate' ? 'selected' : ''}>Real Estate</option>
                                            <option ${onboardingData.industry === 'Coaching' ? 'selected' : ''}>Coaching</option>
                                            <option ${onboardingData.industry === 'Law' ? 'selected' : ''}>Law</option>
                                            <option ${onboardingData.industry === 'Finance' ? 'selected' : ''}>Finance</option>
                                            <option ${onboardingData.industry === 'Healthcare' ? 'selected' : ''}>Healthcare</option>
                                            <option ${onboardingData.industry === 'Retail' ? 'selected' : ''}>Retail</option>
                                            <option ${onboardingData.industry === 'Other' ? 'selected' : ''}>Other</option>
                                        </select>
                                    <div class="form-help" id="industryHelp">Helps AI understand your market.</div>
                                    </div>
                                    <div class="form-row">
                                        <label>Company Size</label>
                                        <select id="companySize" class="input">
                                            <option value="">Select Size</option>
                                            <option ${onboardingData.companySize === 'Just me' ? 'selected' : ''}>Just me</option>
                                            <option ${onboardingData.companySize === '2-10' ? 'selected' : ''}>2-10</option>
                                            <option ${onboardingData.companySize === '11-50' ? 'selected' : ''}>11-50</option>
                                            <option ${onboardingData.companySize === '51-200' ? 'selected' : ''}>51-200</option>
                                            <option ${onboardingData.companySize === '201-500' ? 'selected' : ''}>201-500</option>
                                            <option ${onboardingData.companySize === '500+' ? 'selected' : ''}>500+</option>
                                        </select>
                                    </div>
                                </div>
                            ` : onboardingStep === 2 ? `
                                <!-- Step 2: Details (ONB-02, ONB-07) -->
                                <div class="form-row">
                                    <label>Timezone <span class="required">*</span></label>
                                    <select id="timezone" class="input timezone-select" required>
                                        ${timezones.map(tz => `
                                            <option value="${tz}" ${onboardingData.timezone === tz ? 'selected' : ''}>${tz.replace(/_/g, ' ')}</option>
                                        `).join('')}
                                    </select>
                                    <div class="form-help">Used for scheduling posts at the right time</div>
                                </div>
                                
                                <div class="form-row">
                                    <label for="description">Business Description <span class="required">*</span></label>
                                    <textarea id="description" class="input" rows="3" maxlength="500"
                                              placeholder="e.g., We help startups scale..."
                                              oninput="updateOnboardingCompleteness()">${onboardingData.description}</textarea>
                                    <div class="form-help">What do you do? (Max 500 chars)</div>
                                </div>
                                
                                <div class="form-row">
                                    <label for="targetAudience">Target Audience</label>
                                    <input type="text" id="targetAudience" class="input" placeholder="e.g., CTOs, Busy Moms" value="${onboardingData.targetAudience || ''}" oninput="updateOnboardingCompleteness()">
                                    <div class="form-help">Who are you talking to?</div>
                                </div>
                                
                                <div class="form-row">
                                    <label for="brandTone">Brand Tone</label>
                                    <select id="brandTone" class="input" oninput="updateOnboardingCompleteness()">
                                        <option value="">Select tone...</option>
                                        <option ${onboardingData.brandTone === 'Professional' ? 'selected' : ''}>Professional</option>
                                        <option ${onboardingData.brandTone === 'Casual' ? 'selected' : ''}>Casual</option>
                                        <option ${onboardingData.brandTone === 'Enthusiastic' ? 'selected' : ''}>Enthusiastic</option>
                                        <option ${onboardingData.brandTone === 'Authoritative' ? 'selected' : ''}>Authoritative</option>
                                        <option ${onboardingData.brandTone === 'Witty' ? 'selected' : ''}>Witty</option>
                                        <option ${onboardingData.brandTone === 'Empathetic' ? 'selected' : ''}>Empathetic</option>
                                    </select>
                                    <div class="form-help">How should your posts sound?</div>
                                </div>
                                
                                <div class="form-row">
                                    <label for="website">Website</label>
                                    <input type="url" id="website" class="input" 
                                           placeholder="https://"
                                           value="${onboardingData.website}"
                                           oninput="updateOnboardingCompleteness()">
                                </div>
                                
                                <div class="form-row">
                                    <label>Primary Goal</label>
                                    <select id="primaryGoal" class="input">
                                        <option value="">What brings you to Cydra?</option>
                                        <option ${onboardingData.primaryGoal === 'grow_audience' ? 'selected' : ''}>Grow my audience</option>
                                        <option ${onboardingData.primaryGoal === 'save_time' ? 'selected' : ''}>Save time on content creation</option>
                                        <option ${onboardingData.primaryGoal === 'improve_engagement' ? 'selected' : ''}>Improve engagement</option>
                                        <option ${onboardingData.primaryGoal === 'brand_consistency' ? 'selected' : ''}>Maintain brand consistency</option>
                                        <option ${onboardingData.primaryGoal === 'team_collaboration' ? 'selected' : ''}>Better team collaboration</option>
                                    </select>
                                </div>
                            ` : `
                                <!-- Step 3: Branding (ONB-03) -->
                                <div class="form-row">
                                    <label>Workspace Logo</label>
                                    <div class="logo-upload-area" onclick="document.getElementById('logoInput').click()">
                                        <input type="file" id="logoInput" accept="image/*" style="display: none;" 
                                               onchange="handleLogoUpload(this)">
                                        <div id="logoPlaceholder" class="logo-placeholder" style="${onboardingData.logo ? 'display: none;' : ''}">
                                            <div class="upload-icon">ðŸ“·</div>
                                            <div class="upload-text">Click to upload your logo</div>
                                            <div class="upload-hint">Recommended: 200x200px, PNG or JPG, max 2MB</div>
                                        </div>
                                        <img id="logoPreview" class="logo-preview" src="${onboardingData.logo || ''}" 
                                             style="${onboardingData.logo ? 'display: block;' : 'display: none;'}">
                                    </div>
                                </div>
                                
                                <div class="onboarding-summary">
                                    <h3>Your Workspace Summary</h3>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <span class="summary-label">Name</span>
                                            <span class="summary-value">${onboardingData.workspaceName || '-'}</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">URL</span>
                                            <span class="summary-value">cydrasocial.com/${onboardingData.slug || '-'}</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">Industry</span>
                                            <span class="summary-value">${onboardingData.industry || '-'}</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">Timezone</span>
                                            <span class="summary-value">${onboardingData.timezone?.replace(/_/g, ' ') || '-'}</span>
                                        </div>
                                    </div>
                                </div>
                            `}
                        </div>
                        
                        <div class="onboarding-actions">
                            ${onboardingStep > 1 ? `
                                <button class="btn btn-ghost" onclick="prevOnboardingStep()">â† Back</button>
                            ` : `
                                <div></div>
                            `}
                            ${onboardingStep < 3 ? `
                                <button class="btn btn-primary" onclick="nextOnboardingStep()">Continue â†’</button>
                            ` : `
                                <button class="btn btn-primary" onclick="completeOnboarding()">Continue to Plan Selection â†’</button>
                            `}
                        </div>
                        
                        ${onboardingStep < 3 ? `
                            <div class="skip-link">
                                <a class="auth-link" onclick="completeOnboarding()">Skip for now â†’</a>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function WorkspacesListPage() {
            const workspaces = store.state.workspaces;

            return `
                ${Sidebar()}
                ${Header()}
        <div class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">All Workspaces</h1>
                    <p style="color: var(--text-secondary);">Manage your client workspaces</p>
                </div>
                <button class="btn btn-primary" onclick="router.navigate('/create-workspace')">+ Create New Workspace</button>
            </div>

            <div class="card">
                <table class="content-table">
                    <thead>
                        <tr>
                            <th>Workspace Name</th>
                            <th>Industry</th>
                            <th>Business Type</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${workspaces.map(ws => `
                                    <tr>
                                        <td>
                                            <div style="font-weight: 600;">${ws.name}</div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">@${ws.slug}</div>
                                        </td>
                                        <td>${ws.industry || 'N/A'}</td>
                                        <td>${ws.businessType || 'N/A'}</td>
                                        <td>${formatDate(ws.createdAt)}</td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button class="btn btn-ghost" style="padding: 0.5rem;" onclick="router.navigate('/workspace-settings/${ws.id}')" title="View">ðŸ‘ï¸</button>
                                                <button class="btn btn-ghost" style="padding: 0.5rem;" onclick="router.navigate('/edit-workspace/${ws.id}')" title="Edit">âœï¸</button>
                                                <button class="btn btn-ghost" style="padding: 0.5rem;" onclick="handleDeleteWorkspace('${ws.id}')" title="Delete">ðŸ—‘ï¸</button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        `;
        }

        function CreateWorkspacePage() {
            return `
                ${Sidebar()}
                ${Header()}
        <div class="main-content">
            <div style="margin-bottom: 2rem;">
                <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Create New Workspace</h1>
                <p style="color: var(--text-secondary);">Add a new client or brand workspace</p>
            </div>

            <form onsubmit="handleCreateWorkspace(event)">
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="font-weight: 600; margin-bottom: 1rem;">Business Information</h3>

                    <div class="grid-auto grid-2" style="gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Workspace Name *</label>
                            <input type="text" id="name" class="input" placeholder="Acme Corp Marketing" required>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Legal Name</label>
                            <input type="text" id="legalName" class="input" placeholder="Acme Corporation LLC">
                        </div>
                    </div>

                    <div class="grid-auto grid-2" style="gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Business Type *</label>
                            <select id="businessType" class="input" required>
                                <option value="">Select Type</option>
                                <option>Law Firm</option>
                                <option>Marketing Agency</option>
                                <option>Retail</option>
                                <option>SaaS</option>
                                <option>Non-Profit</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Industry *</label>
                            <input type="text" id="industry" class="input" placeholder="Technology" required>
                        </div>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Description</label>
                        <textarea id="description" class="input" rows="3" placeholder="Brief description of the business..."></textarea>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="font-weight: 600; margin-bottom: 1rem;">Location & Contact</h3>

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Timezone</label>
                        <select id="timezone" class="input">
                            <option value="">Select Timezone</option>
                            <optgroup label="US Timezones">
                                <option>America/New_York</option>
                                <option>America/Chicago</option>
                                <option>America/Denver</option>
                                <option>America/Los_Angeles</option>
                            </optgroup>
                            <optgroup label="European Timezones">
                                <option>Europe/London</option>
                                <option>Europe/Paris</option>
                                <option>Europe/Berlin</option>
                            </optgroup>
                            <optgroup label="Asian Timezones">
                                <option>Asia/Tokyo</option>
                                <option>Asia/Shanghai</option>
                                <option>Asia/Kolkata</option>
                            </optgroup>
                        </select>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Address</label>
                        <input type="text" id="address" class="input" placeholder="123 Main Street">
                    </div>

                    <div class="grid-auto grid-4" style="gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">City</label>
                            <input type="text" id="city" class="input" placeholder="San Francisco">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">State</label>
                            <input type="text" id="state" class="input" placeholder="CA">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Zip</label>
                            <input type="text" id="zip" class="input" placeholder="94105">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Country</label>
                            <input type="text" id="country" class="input" placeholder="United States">
                        </div>
                    </div>

                    <div class="grid-auto grid-2" style="gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Website</label>
                            <input type="url" id="website" class="input" placeholder="https://example.com">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Phone</label>
                            <input type="tel" id="phone" class="input" placeholder="+1 (555) 123-4567">
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-ghost" onclick="router.navigate('/workspaces')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Workspace</button>
                </div>
            </form>
        </div>
        `;
        }

        function EditWorkspacePage(params) {
            const workspaceId = params[0];
            const workspace = store.getWorkspace(workspaceId);

            if (!workspace) {
                return `
                    ${Sidebar()}
                    ${Header()}
        <div class="main-content">
            <div class="card">
                <p>Workspace not found</p>
                <button class="btn btn-primary" onclick="router.navigate('/workspaces')">Back to Workspaces</button>
            </div>
        </div>
        `;
            }

            return `
                ${Sidebar()}
                ${Header()}
        <div class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem;">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Edit Workspace</h1>
                    <p style="color: var(--text-secondary);">Editing: ${workspace.name}</p>
                </div>
                <button class="btn btn-ghost" onclick="router.navigate('/workspaces')">Cancel</button>
            </div>

            <form onsubmit="handleUpdateWorkspace(event, '${workspaceId}')">
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="font-weight: 600; margin-bottom: 1rem;">Business Information</h3>

                    <div class="grid-auto grid-2" style="gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Workspace Name *</label>
                            <input type="text" id="name" class="input" value="${workspace.name}" required>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Legal Name</label>
                            <input type="text" id="legalName" class="input" value="${workspace.legalName || ''}">
                        </div>
                    </div>

                    <div class="grid-auto grid-2" style="gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Business Type</label>
                            <select id="businessType" class="input">
                                <option value="">Select Type</option>
                                ${['Law Firm', 'Marketing Agency', 'Retail', 'SaaS', 'Non-Profit', 'Other'].map(type =>
                `<option ${workspace.businessType === type ? 'selected' : ''}>${type}</option>`
            ).join('')}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Industry</label>
                            <input type="text" id="industry" class="input" value="${workspace.industry || ''}">
                        </div>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Description</label>
                        <textarea id="description" class="input" rows="3">${workspace.description || ''}</textarea>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="font-weight: 600; margin-bottom: 1rem;">Location & Contact</h3>

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Timezone</label>
                        <select id="timezone" class="input">
                            <option value="">Select Timezone</option>
                            <optgroup label="US Timezones">
                                ${['America/New_York', 'America/Chicago', 'America/Denver', 'America/Los_Angeles'].map(tz =>
                `<option ${workspace.timezone === tz ? 'selected' : ''}>${tz}</option>`
            ).join('')}
                            </optgroup>
                            <optgroup label="European Timezones">
                                ${['Europe/London', 'Europe/Paris', 'Europe/Berlin'].map(tz =>
                `<option ${workspace.timezone === tz ? 'selected' : ''}>${tz}</option>`
            ).join('')}
                            </optgroup>
                            <optgroup label="Asian Timezones">
                                ${['Asia/Tokyo', 'Asia/Shanghai', 'Asia/Kolkata'].map(tz =>
                `<option ${workspace.timezone === tz ? 'selected' : ''}>${tz}</option>`
            ).join('')}
                            </optgroup>
                        </select>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Address</label>
                        <input type="text" id="address" class="input" value="${workspace.address || ''}">
                    </div>

                    <div class="grid-auto grid-4" style="gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">City</label>
                            <input type="text" id="city" class="input" value="${workspace.city || ''}">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">State</label>
                            <input type="text" id="state" class="input" value="${workspace.state || ''}">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Zip</label>
                            <input type="text" id="zip" class="input" value="${workspace.zip || ''}">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Country</label>
                            <input type="text" id="country" class="input" value="${workspace.country || ''}">
                        </div>
                    </div>

                    <div class="grid-auto grid-2" style="gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Website</label>
                            <input type="url" id="website" class="input" value="${workspace.website || ''}">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Phone</label>
                            <input type="tel" id="phone" class="input" value="${workspace.phone || ''}">
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="font-weight: 600; margin-bottom: 1rem;">Social Connections</h3>

                    <div class="grid-auto grid-4">
                        ${Object.entries(workspace.connections).map(([platform, data]) => `
                                    <div class="platform-card ${data.connected ? 'selected' : ''}">
                                        ${getPlatformIcon(platform)}
                                        <div style="margin-top: 1rem; font-weight: 600; text-transform: capitalize;">${platform}</div>
                                        ${data.connected ? `
                                            <div style="margin-top: 0.5rem;">
                                                <span class="badge" style="background: #D1FAE5; color: #065F46;">Active</span>
                                            </div>
                                            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">${data.handle}</div>
                                            <button type="button" class="btn btn-ghost" style="margin-top: 1rem; width: 100%; font-size: 0.75rem; color: #EF4444;" onclick="disconnectPlatformInEdit('${platform}')">Disconnect</button>
                                        ` : `
                                            <button type="button" class="btn btn-primary" style="margin-top: 1rem; width: 100%; font-size: 0.75rem;" onclick="connectPlatformInEdit('${platform}')">Connect</button>
                                        `}
                                    </div>
                                `).join('')}
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-ghost" onclick="router.navigate('/workspaces')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
        `;
        }

        function WorkspaceSettingsPage(params) {
            // Check if we have a workspace ID in params (view mode) or use current workspace
            const workspaceId = params && params[0] ? params[0] : store.state.currentWorkspace;
            const workspace = store.getWorkspace(workspaceId);

            if (!workspace) {
                return `
                    ${Sidebar()}
                    ${Header()}
        <div class="main-content">
            <div class="card">
                <p>Workspace not found</p>
                <button class="btn btn-primary" onclick="router.navigate('/workspaces')">Back to Workspaces</button>
            </div>
        </div>
        `;
            }

            return `
                ${Sidebar()}
                ${Header()}
        <div class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem;">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Workspace Details</h1>
                    <p style="color: var(--text-secondary);">${workspace.name}</p>
                </div>
                <button class="btn btn-primary" onclick="router.navigate('/edit-workspace/${workspace.id}')">Edit Workspace</button>
            </div>

            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="font-weight: 600; margin-bottom: 1.5rem;">Business Information</h3>

                <div class="grid-auto grid-2" style="gap: 2rem;">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">WORKSPACE NAME</div>
                        <div style="font-weight: 600;">${workspace.name}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">SLUG</div>
                        <div style="font-weight: 600;">@${workspace.slug}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">LEGAL NAME</div>
                        <div style="font-weight: 600;">${workspace.legalName || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">BUSINESS TYPE</div>
                        <div style="font-weight: 600;">${workspace.businessType || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">INDUSTRY</div>
                        <div style="font-weight: 600;">${workspace.industry || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">TIMEZONE</div>
                        <div style="font-weight: 600;">${workspace.timezone || 'N/A'}</div>
                    </div>
                </div>

                ${workspace.description ? `
                        <div style="margin-top: 1.5rem;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">DESCRIPTION</div>
                            <div style="font-weight: 600;">${workspace.description}</div>
                        </div>
                        ` : ''}
            </div>

            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="font-weight: 600; margin-bottom: 1.5rem;">Location & Contact</h3>

                <div class="grid-auto grid-2" style="gap: 2rem;">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">ADDRESS</div>
                        <div style="font-weight: 600;">${workspace.address || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">CITY</div>
                        <div style="font-weight: 600;">${workspace.city || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">STATE</div>
                        <div style="font-weight: 600;">${workspace.state || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">ZIP CODE</div>
                        <div style="font-weight: 600;">${workspace.zip || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">COUNTRY</div>
                        <div style="font-weight: 600;">${workspace.country || 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">WEBSITE</div>
                        <div style="font-weight: 600;">${workspace.website ? `<a href="${workspace.website}" target="_blank" style="color: var(--primary);">${workspace.website}</a>` : 'N/A'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">PHONE</div>
                        <div style="font-weight: 600;">${workspace.phone || 'N/A'}</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <h3 style="font-weight: 600; margin-bottom: 0.25rem;">Social Connections</h3>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">Connect your social profiles to start scheduling</p>
                    </div>
                    <div style="font-size: 0.875rem; color: var(--text-secondary);">
                        <span style="font-weight: 600;">${Object.values(workspace.connections).filter(c => c.connected).length}</span> / 
                        <span>${workspace.plan === 'agency' ? '25' : workspace.plan === 'team' ? '10' : '3'}</span> accounts connected
                    </div>
                </div>

                <div class="grid-auto grid-4" style="gap: 1rem;">
                    ${Object.entries(workspace.connections).map(([platform, data]) => {
                const platformNames = { linkedin: 'LinkedIn', twitter: 'Twitter / X', facebook: 'Facebook', instagram: 'Instagram' };
                const platformName = platformNames[platform] || platform;
                return `
                            <div class="platform-card ${data.connected ? 'selected' : ''}" style="display: flex; flex-direction: column; align-items: center; padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); transition: all 0.2s;">
                                ${getPlatformIcon(platform)}
                                <div style="margin-top: 1rem; font-weight: 600; text-transform: capitalize;">${platformName}</div>
                                ${data.connected ? `
                                    <div style="margin-top: 0.5rem;">
                                        <span class="badge" style="background: #D1FAE5; color: #065F46;">Connected</span>
                                    </div>
                                    <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">${data.handle}</div>
                                    <button class="btn btn-ghost" style="margin-top: 1rem; font-size: 0.75rem; padding: 0.4rem 1rem;" 
                                            onclick="showDisconnectModal('${platform}', '${platformName}')">
                                        Disconnect
                                    </button>
                                ` : `
                                    <div style="margin-top: 0.5rem;">
                                        <span class="badge" style="background: #FEE2E2; color: #991B1B;">Not Connected</span>
                                    </div>
                                    <button class="btn btn-primary" style="margin-top: 1rem; font-size: 0.75rem; padding: 0.4rem 1rem;" 
                                            onclick="initiateOAuthConnect('${platform}', '${platformName}')">
                                        Connect
                                    </button>
                                `}
                            </div>
                        `;
            }).join('')}
                </div>
                
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border); text-align: center;">
                    <a onclick="router.navigate('/connected-accounts')" style="color: var(--primary); cursor: pointer; font-weight: 500; font-size: 0.875rem;">
                        Manage all connected accounts â†’
                    </a>
                </div>
            </div>
        </div>
        `;
        }

        // ==================== SOCIAL ACCOUNT INTEGRATIONS (Epic 4) ====================

        // SOC-P1-01: Connected Accounts Dashboard/Page
        // Enhanced with SKILL.md design guidelines: distinctive aesthetics, animations, vertical-first layout
        function ConnectedAccountsPage() {
            const workspace = store.getCurrentWorkspace();
            if (!workspace) {
                return `
                    ${Sidebar()}
                    ${Header()}
        <div class="main-content">
            <div class="card" style="text-align: center; padding: 3rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">ðŸ”—</div>
                <h2 style="margin-bottom: 1rem; font-weight: 700;">No Workspace Selected</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Please select or create a workspace to manage your social accounts.</p>
                <button class="btn btn-primary" onclick="router.navigate('/workspaces')">Go to Workspaces</button>
            </div>
        </div>
        `;
            }

            const connections = workspace.connections || {};
            const connectedCount = Object.values(connections).filter(c => c.connected).length;

            // SOC-P1-02: Plan limit enforcement
            const plan = workspace.plan || 'solo';
            // All plans support connecting all social accounts per workspace (no plan-based account limit)
            const maxAccounts = 25;
            const canConnectMore = connectedCount < maxAccounts;
            const progressPercent = Math.min((connectedCount / maxAccounts) * 100, 100);

            const platforms = [
                { id: 'linkedin', name: 'LinkedIn', icon: 'in', color: '#0A66C2', gradient: 'linear-gradient(135deg, #0A66C2 0%, #004182 100%)', description: 'Professional network for business updates' },
                { id: 'twitter', name: 'X (Twitter)', icon: 'ð•', color: '#000000', gradient: 'linear-gradient(135deg, #14171A 0%, #657786 100%)', description: 'Real-time conversations and trends' },
                { id: 'facebook', name: 'Facebook', icon: 'f', color: '#1877F2', gradient: 'linear-gradient(135deg, #1877F2 0%, #0D47A1 100%)', description: 'Engage your community and audience' },
                { id: 'instagram', name: 'Instagram', icon: 'ig', color: '#E4405F', gradient: 'linear-gradient(135deg, #F58529 0%, #DD2A7B 50%, #8134AF 100%)', description: 'Visual storytelling and brand aesthetics' }
            ];

            return `
                ${Sidebar()}
                ${Header()}
        <div class="main-content" style="overflow-y: auto; overflow-x: hidden;">
            <!-- Hero Header with Gradient Background -->
            <div style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.08) 0%, rgba(99, 102, 241, 0.04) 100%); border-radius: 1.5rem; padding: 2rem; margin-bottom: 2rem; animation: fadeInUp 0.5s ease-out;">
                <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 1rem;">
                    <div style="flex: 1; min-width: 250px;">
                        <h1 style="font-size: clamp(1.5rem, 4vw, 2.25rem); font-weight: 800; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--primary) 0%, #818CF8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                            Connected Accounts
                        </h1>
                        <p style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 0.25rem;">
                            Connect your social profiles to start scheduling.
                        </p>
                        <p style="color: var(--text-secondary); font-size: 0.85rem;">
                            Manage connections for <strong style="color: var(--text-primary);">${workspace.name}</strong>
                        </p>
                    </div>
                    <div style="text-align: center; min-width: 200px;">
                        <div style="display: inline-flex; align-items: center; gap: 0.75rem; background: var(--bg-card); padding: 0.75rem 1.5rem; border-radius: 50px; box-shadow: var(--shadow-md);">
                            <div style="width: 80px; height: 8px; background: #E5E7EB; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${progressPercent}%; height: 100%; background: ${progressPercent >= 100 ? '#EF4444' : 'var(--primary)'}; border-radius: 4px; transition: width 0.5s ease;"></div>
                            </div>
                            <span style="font-weight: 700; font-size: 0.9rem; color: ${progressPercent >= 100 ? '#EF4444' : 'var(--primary)'};">
                                Accounts Connected: ${connectedCount} / ${maxAccounts}
                            </span>
                        </div>
                        ${!canConnectMore ? `
                                    <div style="margin-top: 0.75rem;">
                                        <button class="btn" style="font-size: 0.8rem; padding: 0.4rem 1rem; background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%); color: white; border: none; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);" onclick="showUpgradeModal()">
                                            âš¡ Upgrade Plan
                                        </button>
                                    </div>
                                ` : ''}
                    </div>
                </div>
            </div>

            <!-- Platform Cards - Vertical Stack for maximum vertical space -->
            <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem;">
                ${platforms.map((platform, index) => {
                const conn = connections[platform.id] || { connected: false };
                const delay = index * 0.1;
                return `
                                <div class="card social-platform-card" style="padding: 0; overflow: hidden; animation: fadeInUp 0.5s ease-out ${delay}s both; border: none; box-shadow: var(--shadow-md); transition: all 0.3s ease;">
                                    <div style="display: flex; flex-wrap: wrap; align-items: stretch; min-height: 100px;">
                                        <!-- Platform Icon/Branding Column -->
                                        <div style="flex-shrink: 0; width: clamp(60px, 10vw, 80px); background: ${platform.gradient}; display: flex; align-items: center; justify-content: center;">
                                            <span style="color: white; font-weight: 800; font-size: clamp(1.25rem, 3vw, 1.75rem);">${platform.icon}</span>
                                        </div>
                                        
                                        <!-- Content Column -->
                                        <div style="flex: 1; padding: 1.25rem; display: flex; flex-direction: column; justify-content: center; min-width: 200px;">
                                            <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                                <h3 style="font-weight: 700; font-size: 1.1rem; margin: 0;">${platform.name}</h3>
                                                ${conn.connected ? `
                                                    <span style="display: inline-flex; align-items: center; gap: 0.25rem; background: #ECFDF5; color: #059669; padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.75rem; font-weight: 600;">
                                                        <span style="width: 6px; height: 6px; background: #10B981; border-radius: 50%;"></span>
                                                        Connected
                                                    </span>
                                                ` : `
                                                    <span style="display: inline-flex; align-items: center; gap: 0.25rem; background: #F3F4F6; color: #6B7280; padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.75rem; font-weight: 500;">
                                                        Not Connected
                                                    </span>
                                                `}
                                            </div>
                                            ${conn.connected ? `
                                                <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">
                                                    <strong>${conn.handle || '@' + workspace.slug}</strong>
                                                    ${conn.type ? ` Â· ${conn.type}` : ''}
                                                    ${conn.connectedAt ? ` Â· Since ${formatDate(conn.connectedAt)}` : ''}
                                                </p>
                                            ` : `
                                                <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">${platform.description}</p>
                                            `}
                                        </div>
                                        
                                        <!-- Action Column -->
                                        <div style="flex-shrink: 0; padding: 1.25rem; display: flex; align-items: center; justify-content: center; border-left: 1px solid var(--border); min-width: 140px;">
                                            ${conn.connected ? `
                                                <button class="btn btn-ghost" style="color: #DC2626; font-size: 0.875rem; white-space: nowrap;" onclick="showDisconnectModal('${platform.id}', '${platform.name}')">
                                                    Disconnect
                                                </button>
                                            ` : `
                                                ${canConnectMore ? `
                                                    <button class="btn" style="background: ${platform.gradient}; color: white; border: none; font-size: 0.875rem; box-shadow: 0 4px 12px ${platform.color}33; white-space: nowrap; transition: transform 0.2s, box-shadow 0.2s;" 
                                                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px ${platform.color}44';"
                                                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px ${platform.color}33';"
                                                            onclick="initiateOAuthConnect('${platform.id}', '${platform.name}')">
                                                        Connect
                                                    </button>
                                                ` : `
                                                    <button class="btn" style="background: #E5E7EB; color: #9CA3AF; border: none; font-size: 0.875rem; cursor: not-allowed; white-space: nowrap;" disabled>
                                                        Limit Reached
                                                    </button>
                                                `}
                                            `}
                                        </div>
                                    </div>
                                </div>
                            `;
            }).join('')}
            </div>

            <!-- Connection Guide - Collapsible for space efficiency -->
            <div class="card" style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%); border: 1px solid rgba(79, 70, 229, 0.1); animation: fadeInUp 0.5s ease-out 0.5s both;">
                <details style="cursor: pointer;">
                    <summary style="font-weight: 700; font-size: 1rem; color: var(--text-primary); list-style: none; display: flex; align-items: center; justify-content: space-between;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.25rem;">ðŸ’¡</span>
                            Connection Guide
                        </span>
                        <span style="font-size: 0.75rem; color: var(--text-secondary);">Click to expand</span>
                    </summary>
                    <div style="margin-top: 1.25rem; display: flex; flex-direction: column; gap: 1rem;">
                        <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                            <div style="flex: 1; min-width: 200px; padding: 1rem; background: var(--bg-card); border-radius: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="width: 24px; height: 24px; background: #0A66C2; color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 700;">in</span>
                                    <strong>LinkedIn</strong>
                                </div>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Connect personal profiles or company pages via OAuth. Posting rights required.</p>
                            </div>
                            <div style="flex: 1; min-width: 200px; padding: 1rem; background: var(--bg-card); border-radius: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="width: 24px; height: 24px; background: #000; color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.85rem;">ð•</span>
                                    <strong>X (Twitter)</strong>
                                </div>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Secure OAuth 2.0 authorization. Your credentials are never stored.</p>
                            </div>
                            <div style="flex: 1; min-width: 200px; padding: 1rem; background: var(--bg-card); border-radius: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="width: 24px; height: 24px; background: linear-gradient(135deg, #1877F2, #E4405F); color: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700;">M</span>
                                    <strong>Meta Platforms</strong>
                                </div>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Use Meta Business Login to connect Facebook Pages and Instagram Business accounts.</p>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>
        `;
        }

        // SOC-P1-04, SOC-P1-05, SOC-P1-06: OAuth Connect Flow (Simulated)
        function initiateOAuthConnect(platform, platformName) {
            // Show OAuth simulation modal
            const modal = document.createElement('div');
            modal.id = 'oauthModal';
            modal.className = 'modal active';

            let platformSpecificContent = '';
            if (platform === 'linkedin') {
                platformSpecificContent = `
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Select Account Type</label>
                        <select class="input" id="linkedinType" style="width: 100%;">
                            <option value="profile">Personal Profile</option>
                            <option value="page">Company Page</option>
                        </select>
                    </div>
                `;
            } else if (platform === 'facebook' || platform === 'instagram') {
                platformSpecificContent = `
                    <div style="padding: 1rem; background: #E0F2FE; border-radius: 8px; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="font-size: 1.25rem;">ðŸ“‹</span>
                            <span style="font-weight: 600;">Meta Business Login</span>
                        </div>
                        <p style="font-size: 0.875rem; color: #0369A1;">You'll be redirected to Meta to authorize access to your ${platform === 'facebook' ? 'Facebook Pages' : 'Instagram Business Account'}.</p>
                    </div>
                `;
            }

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Connect ${platformName}</h2>
                        <button class="modal-close" onclick="closeOAuthModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <div style="width: 64px; height: 64px; background: ${getPlatformColor(platform)}; color: white; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem; margin: 0 auto 1rem;">
                                ${getPlatformIconText(platform)}
                            </div>
                            <p style="color: var(--text-secondary); margin: 0;">Secure OAuth 2.0 Authorization</p>
                        </div>
                        
                        ${platformSpecificContent}
                        
                        <div style="padding: 1rem; background: #F9FAFB; border-radius: 8px; margin-bottom: 1.5rem;">
                            <h4 style="font-weight: 600; margin-bottom: 0.5rem;">Cydra Social will be able to:</h4>
                            <ul style="font-size: 0.875rem; color: var(--text-secondary); padding-left: 1.5rem; margin: 0;">
                                <li style="margin-bottom: 0.25rem;">Post content on your behalf</li>
                                <li style="margin-bottom: 0.25rem;">Read your profile information</li>
                                <li style="margin-bottom: 0.25rem;">View engagement analytics</li>
                            </ul>
                        </div>
                        
                        <div id="oauthProgress" style="display: none; text-align: center; padding: 2rem;">
                            <div class="spinner" style="margin: 0 auto 1rem;"></div>
                            <p id="oauthStatus">Connecting to ${platformName}...</p>
                        </div>
                        
                        <div id="oauthActions" style="display: flex; gap: 1rem;">
                            <button class="btn btn-ghost" style="flex: 1;" onclick="closeOAuthModal()">Cancel</button>
                            <button class="btn btn-primary" style="flex: 1;" onclick="performOAuthConnect('${platform}', '${platformName}')">
                                Authorize Connection
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function getPlatformColor(platform) {
            const colors = {
                linkedin: '#0A66C2',
                twitter: '#000000',
                facebook: '#1877F2',
                instagram: '#E4405F'
            };
            return colors[platform] || '#6B7280';
        }

        function getPlatformIconText(platform) {
            const icons = {
                linkedin: 'in',
                twitter: 'ð•',
                facebook: 'f',
                instagram: 'ig'
            };
            return icons[platform] || '?';
        }

        function performOAuthConnect(platform, platformName) {
            const progressDiv = document.getElementById('oauthProgress');
            const actionsDiv = document.getElementById('oauthActions');
            const statusP = document.getElementById('oauthStatus');

            progressDiv.style.display = 'block';
            actionsDiv.style.display = 'none';

            // Simulate OAuth flow with multiple steps
            const steps = [
                'Connecting to ' + platformName + '...',
                'Authorizing access...',
                'Retrieving account information...',
                'Finalizing connection...'
            ];

            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                stepIndex++;
                if (stepIndex < steps.length) {
                    statusP.textContent = steps[stepIndex];
                }
            }, 800);

            setTimeout(() => {
                clearInterval(stepInterval);

                // Get workspace and update connection
                const workspace = store.getCurrentWorkspace();
                const linkedinType = document.getElementById('linkedinType');

                workspace.connections[platform] = {
                    connected: true,
                    handle: '@' + workspace.slug,
                    name: workspace.name + (platform === 'linkedin' && linkedinType ? ` (${linkedinType.value === 'page' ? 'Company Page' : 'Personal Profile'})` : ''),
                    type: platform === 'linkedin' && linkedinType ? (linkedinType.value === 'page' ? 'Company Page' : 'Personal Profile') : null,
                    connectedAt: new Date().toISOString()
                };

                store.saveToStorage();
                closeOAuthModal();
                showToast(`${platformName} connected successfully! ðŸŽ‰`);

                // Log activity
                store.addActivity({ type: 'connection', content: `Connected ${platformName} account` });

                // Re-render the appropriate page based on current route
                const currentPath = window.location.hash.replace('#', '') || '/';
                if (currentPath.includes('workspace-settings')) {
                    renderApp(WorkspaceSettingsPage());
                } else {
                    renderApp(ConnectedAccountsPage());
                }
            }, 3500);
        }

        function closeOAuthModal() {
            const modal = document.getElementById('oauthModal');
            if (modal) {
                modal.remove();
            }
        }

        // SOC-P1-03: Disconnect Account with Draft Conversion
        function showDisconnectModal(platform, platformName) {
            // Check if there are any scheduled posts for this platform
            const scheduledPosts = store.state.posts.filter(p =>
                p.status === 'scheduled' && p.platforms && p.platforms.includes(platform)
            );

            const modal = document.createElement('div');
            modal.id = 'disconnectModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600; color: #DC2626; margin: 0;">âš ï¸ Disconnect ${platformName}</h2>
                        <button class="modal-close" onclick="closeDisconnectModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div style="padding: 1rem; background: #FEF2F2; border-radius: 8px; margin-bottom: 1.5rem;">
                            <p style="color: #991B1B; margin-bottom: 0.5rem; font-weight: 500;">Are you sure you want to disconnect this account?</p>
                            <p style="font-size: 0.875rem; color: #7F1D1D; margin: 0;">This will revoke Cydra's access to your ${platformName} account.</p>
                        </div>
                        
                        ${scheduledPosts.length > 0 ? `
                            <div style="padding: 1rem; background: #FFFBEB; border-radius: 8px; margin-bottom: 1.5rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span>ðŸ“‹</span>
                                    <span style="font-weight: 600; color: #92400E;">${scheduledPosts.length} Scheduled Post${scheduledPosts.length > 1 ? 's' : ''} Found</span>
                                </div>
                                <p style="font-size: 0.875rem; color: #92400E; margin-bottom: 0.75rem;">
                                    You have scheduled posts for this platform. They will be converted to drafts to prevent failed publishing.
                                </p>
                                <div style="max-height: 120px; overflow-y: auto; font-size: 0.75rem; color: #78716C;">
                                    ${scheduledPosts.slice(0, 5).map(p => `
                                        <div style="padding: 0.25rem 0; border-bottom: 1px solid #FDE68A;">â€¢ ${(p.content || '').substring(0, 50)}...</div>
                                    `).join('')}
                                    ${scheduledPosts.length > 5 ? `<div style="padding: 0.25rem 0;">...and ${scheduledPosts.length - 5} more</div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-ghost" style="flex: 1;" onclick="closeDisconnectModal()">Cancel</button>
                            <button class="btn" style="flex: 1; background: #DC2626; color: white; border: none;" onclick="confirmDisconnect('${platform}', '${platformName}', ${scheduledPosts.length})">
                                Disconnect
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function closeDisconnectModal() {
            const modal = document.getElementById('disconnectModal');
            if (modal) {
                modal.remove();
            }
        }

        function confirmDisconnect(platform, platformName, scheduledCount) {
            // Convert scheduled posts to drafts
            if (scheduledCount > 0) {
                store.state.posts = store.state.posts.map(post => {
                    if (post.status === 'scheduled' && post.platforms && post.platforms.includes(platform)) {
                        return { ...post, status: 'draft' };
                    }
                    return post;
                });
            }

            // Disconnect the account
            const workspace = store.getCurrentWorkspace();
            workspace.connections[platform] = { connected: false };

            store.saveToStorage();

            // Log activity
            store.addActivity({ type: 'disconnection', content: `Disconnected ${platformName} account` });

            closeDisconnectModal();

            if (scheduledCount > 0) {
                showToast(`${platformName} disconnected. ${scheduledCount} post${scheduledCount > 1 ? 's' : ''} moved to drafts.`);
            } else {
                showToast(`${platformName} disconnected successfully.`);
            }

            // Re-render the appropriate page based on current route
            const currentPath = window.location.hash.replace('#', '') || '/';
            if (currentPath.includes('workspace-settings')) {
                renderApp(WorkspaceSettingsPage());
            } else {
                renderApp(ConnectedAccountsPage());
            }
        }

        // Upgrade Modal (e.g. for workspace limit or other upgrade prompts)
        function showUpgradeModal() {
            const modal = document.createElement('div');
            modal.id = 'upgradeModal';
            modal.className = 'modal active';
            modal.innerHTML = `
            <div class="modal-content" style="max-width: 650px;">
                    <div class="modal-header">
                        <h2 style="font-size: 1.25rem; font-weight: 600;">Upgrade Your Plan</h2>
                        <button class="modal-close" onclick="closeUpgradeModal()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Unlock more workspaces and advanced features with our Team and Agency plans.</p>

                        <div class="grid-auto grid-2" style="gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="card" style="padding: 1.5rem; border: 2px solid var(--primary); position: relative;">
                                <div class="badge" style="position: absolute; top: -10px; right: 1rem; background: var(--primary); color: white;">POPULAR</div>
                                <h3 style="font-weight: 700; margin-bottom: 0.5rem;">Team Plan</h3>
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 1rem;">$99<span style="font-size: 1rem; color: var(--text-secondary);">/mo</span></div>
                                <ul style="font-size: 0.875rem; color: var(--text-secondary); padding-left: 1.5rem; margin-bottom: 1.5rem;">
                                    <li style="margin-bottom: 0.5rem;">1â€“3 Workspaces</li>
                                    <li style="margin-bottom: 0.5rem;">Up to 5 users included</li>
                                    <li style="margin-bottom: 0.5rem;">150 AI Credits/month</li>
                                    <li style="margin-bottom: 0.5rem;">Unlimited manual posts</li>
                                </ul>
                                <button class="btn btn-primary" style="width: 100%;" onclick="closeUpgradeModal(); joinWaitlist('team');">Join Team Waitlist</button>
                                <p style="font-size: 0.7rem; color: var(--text-secondary); text-align: center; margin-top: 0.5rem;">Coming Soon</p>
                            </div>
                            
                            <div class="card" style="padding: 1.5rem; border: 2px solid var(--border);">
                                <h3 style="font-weight: 700; margin-bottom: 0.5rem;">Agency Plan</h3>
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 1rem;">$299<span style="font-size: 1rem; color: var(--text-secondary);">/mo</span></div>
                                <ul style="font-size: 0.875rem; color: var(--text-secondary); padding-left: 1.5rem; margin-bottom: 1.5rem;">
                                    <li style="margin-bottom: 0.5rem;">Up to 5 Workspaces</li>
                                    <li style="margin-bottom: 0.5rem;">Up to 15 users included</li>
                                    <li style="margin-bottom: 0.5rem;">500 AI Credits/month</li>
                                    <li style="margin-bottom: 0.5rem;">Unlimited manual posts</li>
                                </ul>
                                <button class="btn btn-ghost" style="width: 100%;" onclick="closeUpgradeModal(); joinWaitlist('agency');">Join Waitlist</button>
                                <p style="font-size: 0.7rem; color: var(--text-secondary); text-align: center; margin-top: 0.5rem;">Coming Soon</p>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-ghost" onclick="closeUpgradeModal()">Cancel</button>
                        </div>
                    </div>
                </div >
            `;

            document.body.appendChild(modal);
        }

        function closeUpgradeModal() {
            const modal = document.getElementById('upgradeModal');
            if (modal) {
                modal.remove();
            }
        }

        function simulateUpgrade(plan) {
            const workspace = store.getCurrentWorkspace();
            workspace.plan = plan;
            store.saveToStorage();

            closeUpgradeModal();
            showToast(`ðŸŽ‰ Upgraded to ${plan.charAt(0).toUpperCase() + plan.slice(1)} Plan!(Demo Mode)`);

            // Log activity
            store.addActivity({ type: 'upgrade', content: `Upgraded to ${plan} plan` });

            // Re-render the page
            renderApp(ConnectedAccountsPage());
        }

        // ==================== BILLING & SUBSCRIPTION (BILL-P1) ====================

        // BILL-P1-01: Plan Selection Page
        function PlanSelectionPage() {
            const workspace = store.getCurrentWorkspace();

            return `
                <div class="onboarding-page">
                    <div class="onboarding-container" style="max-width: 900px;">
                        <div class="onboarding-header">
                            <img src="${APP_LOGO}" alt="Cydra" style="height: 50px; margin-bottom: 1rem;">
                            <h2 class="onboarding-title">Choose the plan that fits your growth</h2>
                            <p class="onboarding-subtitle">All plans include AI-powered content generation and scheduling</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                            <!-- Solo Plan - $49/mo (BILL-P1-01) -->
                            <div class="card" style="padding: 2rem; border: 2px solid var(--primary); position: relative; display: flex; flex-direction: column;">
                                <div class="badge" style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; font-size: 0.7rem; padding: 0.25rem 0.75rem;">BEST FOR INDIVIDUALS</div>
                                <h3 style="font-weight: 700; font-size: 1.5rem; margin-bottom: 0.5rem; text-align: center;">Solo</h3>
                                <div style="text-align: center; margin-bottom: 1.5rem;">
                                    <span style="font-size: 2.5rem; font-weight: 800; color: var(--primary);">$49</span>
                                    <span style="color: var(--text-secondary);">/month</span>
                                </div>
                                <ul style="font-size: 0.875rem; color: var(--text-secondary); padding-left: 1.25rem; margin-bottom: 1.5rem; flex-grow: 1;">
                                    <li style="margin-bottom: 0.5rem;">1 Workspace</li>
                                    <li style="margin-bottom: 0.5rem;">1 User included</li>
                                    <li style="margin-bottom: 0.5rem;">LinkedIn, X, Meta (Instagram &amp; Facebook)</li>
                                    <li style="margin-bottom: 0.5rem;">50 AI Credits/month</li>
                                    <li style="margin-bottom: 0.5rem;">Unlimited manual posts</li>
                                </ul>
                                <button class="btn btn-primary" style="width: 100%;" onclick="router.navigate('/checkout/solo')">Start 7-Day Trial</button>
                                <p style="font-size: 0.75rem; color: var(--text-secondary); text-align: center; margin-top: 0.5rem;">Credit card required</p>
                            </div>
                            
                            <!-- Team Plan - $99/mo (BILL-P1-01) -->
                            <div class="card" style="padding: 2rem; border: 2px solid var(--border); position: relative; display: flex; flex-direction: column;">
                                <div class="badge" style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #8B5CF6, #6366F1); color: white; font-size: 0.7rem; padding: 0.25rem 0.75rem;">COMING SOON</div>
                                <h3 style="font-weight: 700; font-size: 1.5rem; margin-bottom: 0.5rem; text-align: center;">Team</h3>
                                <div style="text-align: center; margin-bottom: 1.5rem;">
                                    <span style="font-size: 2.5rem; font-weight: 800; color: var(--text-primary);">$99</span>
                                    <span style="color: var(--text-secondary);">/month</span>
                                </div>
                                <ul style="font-size: 0.875rem; color: var(--text-secondary); padding-left: 1.25rem; margin-bottom: 1.5rem; flex-grow: 1;">
                                    <li style="margin-bottom: 0.5rem;">1â€“3 Workspaces</li>
                                    <li style="margin-bottom: 0.5rem;">Up to 5 users included</li>
                                    <li style="margin-bottom: 0.5rem;">LinkedIn, X, Meta (Instagram &amp; Facebook)</li>
                                    <li style="margin-bottom: 0.5rem;">150 AI Credits/month</li>
                                    <li style="margin-bottom: 0.5rem;">Unlimited manual posts</li>
                                </ul>
                                <button class="btn btn-ghost" style="width: 100%;" onclick="joinWaitlist('team')">Join Waitlist</button>
                            </div>
                            
                            <!-- Agency Plan - $299/mo (BILL-P1-01) -->
                            <div class="card" style="padding: 2rem; border: 2px solid var(--border); position: relative; display: flex; flex-direction: column;">
                                <div class="badge" style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #F59E0B, #D97706); color: white; font-size: 0.7rem; padding: 0.25rem 0.75rem;">COMING SOON</div>
                                <h3 style="font-weight: 700; font-size: 1.5rem; margin-bottom: 0.5rem; text-align: center;">Agency</h3>
                                <div style="text-align: center; margin-bottom: 1.5rem;">
                                    <span style="font-size: 2.5rem; font-weight: 800; color: var(--text-primary);">$299</span>
                                    <span style="color: var(--text-secondary);">/month</span>
                                </div>
                                <ul style="font-size: 0.875rem; color: var(--text-secondary); padding-left: 1.25rem; margin-bottom: 1.5rem; flex-grow: 1;">
                                    <li style="margin-bottom: 0.5rem;">Up to 5 Workspaces</li>
                                    <li style="margin-bottom: 0.5rem;">Up to 15 users included</li>
                                    <li style="margin-bottom: 0.5rem;">LinkedIn, X, Meta (Instagram &amp; Facebook)</li>
                                    <li style="margin-bottom: 0.5rem;">500 AI Credits/month</li>
                                    <li style="margin-bottom: 0.5rem;">Unlimited manual posts</li>
                                </ul>
                                <button class="btn btn-ghost" style="width: 100%;" onclick="joinWaitlist('agency')">Join Waitlist</button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 1rem;">
                            <p style="font-size: 0.875rem; color: var(--text-secondary);">
                                All plans come with a 7-day free trial. Cancel anytime.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Checkout page (full page instead of popup) â€“ plan in path: /checkout/solo
        function CheckoutPage(plan) {
            const planPrices = { solo: 49, team: 99, agency: 299 };
            const planCredits = { solo: 50, team: 150, agency: 500 };
            const planName = (plan || 'solo').charAt(0).toUpperCase() + (plan || 'solo').slice(1);
            const price = planPrices[plan] || 49;
            const credits = planCredits[plan] || 50;
            return `
                <div class="onboarding-page">
                    <div class="onboarding-container" style="max-width: 520px;">
                        <div style="margin-bottom: 1.5rem;">
                            <a href="#" onclick="router.navigate('/select-plan'); return false;" style="color: var(--text-secondary); font-size: 0.875rem; text-decoration: none;">â† Back to plans</a>
                        </div>
                        <div style="background: linear-gradient(135deg, #635BFF 0%, #8B5CF6 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 1.5rem;">
                            <div style="font-size: 1.25rem; font-weight: 700;">ðŸ’³ Cydra Social</div>
                            <div style="opacity: 0.9; margin-top: 0.25rem;">Subscribe to ${planName} Plan</div>
                        </div>
                        <div class="card" style="padding: 1.5rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                <span style="color: var(--text-secondary);">${planName} Plan (7-day free trial)</span>
                                <span style="font-weight: 600;">$${price}/mo</span>
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">âœ“ ${credits} AI Credits/month â€¢ âœ“ Cancel anytime</div>
                        </div>
                        <div class="card" style="padding: 1.25rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.8rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.02em;">Optional add-ons</div>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0; cursor: pointer;">
                                <input type="checkbox" id="addon_ai50_3m" aria-label="Extra AI Credits 50 for 3 months">
                                <span style="flex: 1; font-size: 0.9rem;">Extra AI Credits (50) â€“ 3 months</span>
                                <span style="font-weight: 600;">$15</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0; cursor: pointer;">
                                <input type="checkbox" id="addon_ai100" aria-label="Extra AI Credits 100">
                                <span style="flex: 1; font-size: 0.9rem;">Extra AI Credits (100)</span>
                                <span style="font-weight: 600;">$25</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.4rem 0;">
                                <label for="addon_workspace_qty" style="flex: 1; font-size: 0.9rem;">Additional Workspace</label>
                                <input type="number" id="addon_workspace_qty" class="checkout-qty-input" min="0" value="0" aria-label="Quantity additional workspace">
                                <span style="font-weight: 600; font-size: 0.85rem;">$39/mo each</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.4rem 0;">
                                <label for="addon_seat_qty" style="flex: 1; font-size: 0.9rem;">Additional User Seat</label>
                                <input type="number" id="addon_seat_qty" class="checkout-qty-input" min="0" value="0" aria-label="Quantity additional user seat">
                                <span style="font-weight: 600; font-size: 0.85rem;">$15/mo each</span>
                            </div>
                            <div id="checkoutAddonLines" style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;"></div>
                            <div style="display: flex; justify-content: space-between; margin-top: 0.75rem; font-weight: 600; padding-top: 0.5rem; border-top: 1px dashed var(--border);">
                                <span>Total (first month)</span>
                                <span id="checkoutTotal">$${price}</span>
                            </div>
                        </div>
                        <div class="card" style="padding: 1.25rem; margin-bottom: 1.5rem;">
                            <div style="font-size: 0.8rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-secondary); text-transform: uppercase;">Payment</div>
                            <div style="margin-bottom: 0.75rem;">
                                <label style="display: block; font-size: 0.8rem; font-weight: 500; margin-bottom: 0.35rem;">Card Number</label>
                                <div style="display: flex; align-items: center; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 0.6rem 0.75rem;">
                                    <span style="margin-right: 0.5rem;">ðŸ’³</span>
                                    <input type="text" value="4242 4242 4242 4242" readonly style="flex: 1; background: transparent; border: none; font-family: monospace; font-size: 0.95rem; color: var(--text-primary);">
                                    <span style="color: var(--text-secondary); font-size: 0.7rem;">TEST</span>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                <div>
                                    <label style="display: block; font-size: 0.8rem; font-weight: 500; margin-bottom: 0.35rem;">Expiry</label>
                                    <input type="text" value="12/28" readonly class="input" style="text-align: center; padding: 0.6rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-size: 0.8rem; font-weight: 500; margin-bottom: 0.35rem;">CVC</label>
                                    <input type="text" value="123" readonly class="input" style="text-align: center; padding: 0.6rem;">
                                </div>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 8px; padding: 0.6rem 0.75rem; margin-bottom: 1rem; font-size: 0.85rem; color: #92400E;">ðŸŽ­ Demo: No real charges will be made</div>
                        <button id="processPaymentBtn" type="button" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.05rem; font-weight: 600;" onclick="processStripePaymentFromPage('${plan || 'solo'}')">
                            Start Free Trial â†’
                        </button>
                        <button type="button" style="width: 100%; margin-top: 0.75rem; background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 0.5rem; font-size: 0.9rem;" onclick="router.navigate('/select-plan')">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
        }

        function CheckoutSuccessPage(planName, totalCredits, addonSummary) {
            const addonText = addonSummary.length ? '<p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">Add-ons: ' + addonSummary.join(', ') + '</p>' : '';
            return `
                <div class="onboarding-page">
                    <div class="onboarding-container" style="max-width: 420px; text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸŽ‰</div>
                        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #10B981;">Payment Successful!</h2>
                        <p style="color: var(--text-secondary);">
                            Welcome to Cydra Social ${planName}.<br>Your 7-day free trial has started.
                        </p>
                        ${addonText}
                        <div class="card" style="padding: 1.25rem; margin: 1.5rem 0;">
                            <div style="display: flex; justify-content: center; gap: 2rem;">
                                <div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">${totalCredits}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">AI Credits</div>
                                </div>
                                <div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">7</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">Trial Days</div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" style="width: 100%; padding: 1rem;" onclick="router.navigate('/dashboard')">
                            Go to Dashboard â†’
                        </button>
                    </div>
                </div>
            `;
        }

        // Optional add-ons: read from checkout page (or modal) â€“ used by processStripePayment / processStripePaymentFromPage
        function getCheckoutAddonsFromDom() {
            const el = (id) => document.getElementById(id);
            const ai50 = el('addon_ai50_3m');
            const ai100 = el('addon_ai100');
            const ws = el('addon_workspace_qty');
            const seat = el('addon_seat_qty');
            return {
                ai50_3m: ai50 ? ai50.checked : false,
                ai100: ai100 ? ai100.checked : false,
                workspaceQty: Math.max(0, parseInt(ws && ws.value ? ws.value : 0, 10) || 0),
                seatQty: Math.max(0, parseInt(seat && seat.value ? seat.value : 0, 10) || 0)
            };
        }

        function setupCheckoutAddonListeners(plan) {
            const planPrices = { solo: 49, team: 99, agency: 299 };
            const planPrice = planPrices[plan] || 49;
            const totalEl = document.getElementById('checkoutTotal');
            const addonLinesEl = document.getElementById('checkoutAddonLines');
            function update() {
                const a = getCheckoutAddonsFromDom();
                const oneTime = (a.ai50_3m ? 15 : 0) + (a.ai100 ? 25 : 0);
                const monthly = a.workspaceQty * 39 + a.seatQty * 15;
                const total = planPrice + oneTime + monthly;
                if (totalEl) totalEl.textContent = '$' + total;
                const parts = [];
                if (a.ai50_3m) parts.push('Extra AI (50, 3 mo): $15');
                if (a.ai100) parts.push('Extra AI (100): $25');
                if (a.workspaceQty) parts.push(a.workspaceQty + ' Workspace(s): $' + (a.workspaceQty * 39) + '/mo');
                if (a.seatQty) parts.push(a.seatQty + ' Seat(s): $' + (a.seatQty * 15) + '/mo');
                if (addonLinesEl) addonLinesEl.innerHTML = parts.length ? parts.join('<br>') : '';
            }
            ['addon_ai50_3m', 'addon_ai100', 'addon_workspace_qty', 'addon_seat_qty'].forEach(function(id) {
                const el = document.getElementById(id);
                if (el) { el.addEventListener('change', update); if (el.type === 'number') el.addEventListener('input', update); }
            });
            update();
        }

        // Navigate to checkout page (no popup)
        function handlePlanSelection(plan) {
            const workspace = store.getCurrentWorkspace();
            if (!workspace) {
                showToast('Please create a workspace first');
                router.navigate('/onboarding');
                return;
            }
            router.navigate('/checkout/' + (plan || 'solo'));
        }

        // Process payment from checkout page
        function processStripePaymentFromPage(plan) {
            const btn = document.getElementById('processPaymentBtn');
            const planCredits = { solo: 50, team: 150, agency: 500 };
            const planName = (plan || 'solo').charAt(0).toUpperCase() + (plan || 'solo').slice(1);
            const addons = getCheckoutAddonsFromDom();
            let extraCredits = 0;
            if (addons.ai50_3m) extraCredits += 50;
            if (addons.ai100) extraCredits += 100;
            const addonSummary = [];
            if (addons.ai50_3m) addonSummary.push('Extra AI Credits (50) â€“ 3 months');
            if (addons.ai100) addonSummary.push('Extra AI Credits (100)');
            if (addons.workspaceQty) addonSummary.push(addons.workspaceQty + ' Additional Workspace(s)');
            if (addons.seatQty) addonSummary.push(addons.seatQty + ' Additional User Seat(s)');

            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<span style="display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;"><span class="spinner" style="width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;"></span> Processing...</span>';
            }

            setTimeout(() => {
                const workspace = store.getCurrentWorkspace();
                if (workspace) {
                    workspace.plan = plan || 'solo';
                    workspace.subscriptionStatus = 'active';
                    workspace.subscriptionStartDate = new Date().toISOString();
                    workspace.trialEndsAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();
                    workspace.aiCredits = (planCredits[plan] || 50) + extraCredits;
                    workspace.addOns = { ai50_3m: addons.ai50_3m, ai100: addons.ai100, additionalWorkspaces: addons.workspaceQty, additionalSeats: addons.seatQty };
                    localStorage.setItem('selectedPlan', plan || 'solo');
                    store.saveToStorage();
                    store.addActivity({ type: 'subscription', content: 'Subscribed to ' + (plan || 'solo') + ' plan (7-day trial)' + (addonSummary.length ? ' + add-ons' : '') });
                }
                createConfetti();
                renderApp(CheckoutSuccessPage(planName, (planCredits[plan] || 50) + extraCredits, addonSummary));
            }, 1200);
        }

        // Create confetti celebration effect
        function createConfetti() {
            const colors = ['#635BFF', '#10B981', '#F59E0B', '#EC4899', '#3B82F6'];
            const container = document.body;

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    top: -10px;
                    left: ${Math.random() * 100}%;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    pointer-events: none;
                    z-index: 100000;
                    animation: confettiFall ${Math.random() * 2 + 2}s linear forwards;
                `;
                container.appendChild(confetti);
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        // Join waitlist for Team/Agency plans (Phase 1)
        function joinWaitlist(plan) {
            const planName = plan.charAt(0).toUpperCase() + plan.slice(1);

            // Create modal for waitlist signup
            const modal = document.createElement('div');
            modal.id = 'waitlistModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 450px;">
                    <div class="modal-header">
                        <h2 style="font-size: 1.25rem; font-weight: 600;">ðŸš€ Join ${planName} Waitlist</h2>
                        <button class="modal-close" onclick="document.getElementById('waitlistModal').remove()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            The ${planName} plan is coming soon! Be the first to know when it launches.
                        </p>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email Address</label>
                            <input type="email" id="waitlistEmail" class="input" placeholder="your@email.com" value="${store.state.user?.email || ''}">
                        </div>
                        <button class="btn btn-primary" style="width: 100%;" onclick="submitWaitlist('${plan}')">
                            Join Waitlist
                        </button>
                        <p style="font-size: 0.75rem; color: var(--text-secondary); text-align: center; margin-top: 1rem;">
                            We'll notify you when ${planName} launches. No spam, ever.
                        </p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function submitWaitlist(plan) {
            const email = document.getElementById('waitlistEmail').value;
            if (!email || !email.includes('@')) {
                showToast('Please enter a valid email address');
                return;
            }

            // Simulate API call
            document.getElementById('waitlistModal').remove();
            showToast(`âœ“ You're on the ${plan.charAt(0).toUpperCase() + plan.slice(1)} waitlist! We'll email you when it launches.`);
        }

        // ==================== PUBLIC WEBSITE PAGES ====================

        // Public Navbar Component
        function PublicNavbar() {
            return `
            <nav class="public-navbar">
                <div class="navbar-container">
                    <div class="navbar-brand" onclick="router.navigate('/home')">
                        <img src="${APP_LOGO}" alt="Cydra Social">
                    </div>
                    <div class="navbar-actions">
                        <span class="navbar-link" onclick="scrollToPricing()">Pricing</span>
                        <span class="navbar-link" onclick="router.navigate('/about')">About Us</span>
                        <span class="navbar-link" onclick="router.navigate('/login')">Login</span>
                        <button class="btn btn-primary" onclick="router.navigate('/signup')">Get Started</button>
                    </div>
                </div>
            </nav>
            `;
        }

        // Public Footer Component
        function PublicFooter() {
            return `
            <footer class="public-footer">
                <div class="footer-container">
                    <div class="footer-brand">
                        <img src="${APP_LOGO}" alt="Cydra Social">
                        <span>Cydra Social</span>
                    </div>
                    <div class="footer-links">
                        <a href="#/about" class="footer-link">About Us</a>
                        <a href="#/terms" class="footer-link">Terms &amp; Conditions</a>
                        <a href="#/privacy" class="footer-link">Privacy Policy</a>
                        <a href="#/login" class="footer-link">Login</a>
                    </div>
                    <div class="footer-copyright">
                        Â© ${new Date().getFullYear()} Cydra Social. All rights reserved.
                    </div>
                </div>
            </footer>
            `;
        }

        // Scroll to pricing section
        function scrollToPricing() {
            const pricingSection = document.getElementById('pricing-section');
            if (pricingSection) {
                pricingSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Plan selection handler (WEB-03)
        function selectPlan(planName) {
            // WEB-03: Store plan so after signup + onboarding we redirect to checkout with plan pre-selected
            localStorage.setItem('preSelectedPlan', planName);
            router.navigate('/signup');
        }

        // Home Page (WEB-01): Hero + Pricing; WEB-03: Solo CTA stores plan and goes to Sign Up
        function HomePage() {
            return `
                ${PublicNavbar()}

                <section class="hero-section" aria-labelledby="hero-heading">
                    <div class="hero-content">
                        <h1 id="hero-heading" class="hero-headline">Create smarter social content. Publish with confidence.</h1>
                        <p class="hero-subheadline">AI-powered content creation and scheduling for social media professionals.</p>
                        <div class="hero-cta-group">
                            <a href="#/signup" class="btn-hero-primary" role="button">Get Started</a>
                            <button type="button" class="btn-hero-secondary" onclick="scrollToPricing()">View Plans</button>
                        </div>
                    </div>
                </section>

                <section class="pricing-section" id="pricing-section" aria-labelledby="pricing-title">
                    <div class="pricing-container">
                        <div class="pricing-header">
                            <h2 id="pricing-title" class="pricing-title">Simple, Transparent Pricing</h2>
                            <p class="pricing-subtitle">Choose the perfect plan for your needs. Start with a free trial and upgrade anytime.</p>
                        </div>

                        <div class="pricing-cards">
                            <div class="pricing-card">
                                <h3 class="pricing-plan-name">Solo</h3>
                                <div class="pricing-plan-price">
                                    <span class="price-amount">$49</span>
                                    <span class="price-period">/month</span>
                                </div>
                                <p class="pricing-description">Individuals &amp; founders</p>
                                <ul class="pricing-features">
                                    <li>1 Workspace</li>
                                    <li>1 User included</li>
                                    <li>LinkedIn, X, Meta (Instagram &amp; Facebook)</li>
                                    <li>50 AI Credits/month</li>
                                    <li>Unlimited manual posts</li>
                                </ul>
                                <button type="button" class="pricing-cta primary" onclick="selectPlan('solo')">Start 7-Day Trial</button>
                            </div>

                            <div class="pricing-card featured">
                                <h3 class="pricing-plan-name">Team</h3>
                                <div class="pricing-plan-price">
                                    <span class="price-amount">$99</span>
                                    <span class="price-period">/month</span>
                                </div>
                                <p class="pricing-description">Small teams</p>
                                <ul class="pricing-features">
                                    <li>1â€“3 Workspaces</li>
                                    <li>Up to 5 users included</li>
                                    <li>LinkedIn, X, Meta (Instagram &amp; Facebook)</li>
                                    <li>150 AI Credits/month</li>
                                    <li>Unlimited manual posts</li>
                                </ul>
                                <button type="button" class="pricing-cta secondary" onclick="showComingSoonModal('team')">Coming Soon</button>
                            </div>

                            <div class="pricing-card">
                                <h3 class="pricing-plan-name">Agency</h3>
                                <div class="pricing-plan-price">
                                    <span class="price-amount">$299</span>
                                    <span class="price-period">/month</span>
                                </div>
                                <p class="pricing-description">Agencies &amp; client work</p>
                                <ul class="pricing-features">
                                    <li>Up to 5 Workspaces</li>
                                    <li>Up to 15 users included</li>
                                    <li>LinkedIn, X, Meta (Instagram &amp; Facebook)</li>
                                    <li>500 AI Credits/month</li>
                                    <li>Unlimited manual posts</li>
                                </ul>
                                <button type="button" class="pricing-cta secondary" onclick="showComingSoonModal('agency')">Coming Soon</button>
                            </div>
                        </div>
                    </div>
                </section>

                ${PublicFooter()}
            `;
        }

        // Phase 1: Team/Agency show "Coming Soon" â€” optional sign up for waitlist
        function showComingSoonModal(planName) {
            const name = planName === 'team' ? 'Team' : 'Agency';
            const modal = document.createElement('div');
            modal.id = 'comingSoonModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="document.getElementById('comingSoonModal').remove()"></div>
                <div class="modal-content" style="max-width: 400px;">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0;">${name} Plan â€” Coming Soon</h3>
                        <button type="button" class="modal-close" onclick="document.getElementById('comingSoonModal').remove()" aria-label="Close">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">The ${name} plan will be available soon. Sign up now to get notified when it launches.</p>
                        <div style="display: flex; gap: 0.75rem;">
                            <button type="button" class="btn btn-primary" onclick="document.getElementById('comingSoonModal').remove(); router.navigate('/signup');">Get Started</button>
                            <button type="button" class="btn btn-ghost" onclick="document.getElementById('comingSoonModal').remove()">Close</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // About Page (WEB-02)
        function AboutPage() {
            return `
                ${PublicNavbar()}

        <div class="legal-page">
            <div class="legal-content">
                <h1 class="legal-title">About Us</h1>
                <p class="legal-updated">Our Story</p>

                <div class="legal-section">
                    <h2>The Frustration with Blank Screens</h2>
                    <p>We've all been there. Staring at a blank screen, cursor blinking, with no idea what to post. Hours wasted trying to come up with engaging content that resonates with your audience.</p>
                    <p>Cydra Social was born from this frustration. Our founders, experienced social media managers themselves, understood the daily struggle of creating consistent, high-quality content across multiple platforms.</p>
                </div>

                <div class="legal-section">
                    <h2>Our AI Philosophy</h2>
                    <p>We believe AI should augment human creativity, not replace it. Our AI assistantsâ€”the Viral Momentum Architect, Community Engagement Catalyst, and Algorithmic Outreach Strategistâ€”work together to generate multiple content variants for you to choose from.</p>
                    <p>You remain in control. Our AI provides suggestions, insights, and drafts, but the final decision is always yours. We're here to eliminate the blank screen problem while preserving your unique voice and brand identity.</p>
                </div>

                <div class="legal-section">
                    <h2>Our Mission</h2>
                    <p>To empower creators, businesses, and agencies to produce exceptional social content effortlessly, so they can focus on what matters mostâ€”building genuine connections with their audience.</p>
                </div>

                <div class="legal-section">
                    <h2>Contact Us</h2>
                    <p>Have questions? We'd love to hear from you.</p>
                    <p>Email: hello@cydrasocial.com</p>
                </div>
            </div>
        </div>
                
                ${PublicFooter()}
        `;
        }

        // Privacy Policy Page (WEB-02)
        function PrivacyPage() {
            return `
                ${PublicNavbar()}

        <div class="legal-page">
            <div class="legal-content">
                <h1 class="legal-title">Privacy Policy</h1>
                <p class="legal-updated">Last updated: ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>

                <div class="legal-section">
                    <h2>Data Collection</h2>
                    <p>We collect information you provide directly to us, such as when you create an account, use our services, or contact us for support. This includes:</p>
                    <ul>
                        <li>Account information (name, email, password)</li>
                        <li>Workspace and business details</li>
                        <li>Content you create or upload</li>
                        <li>Social media account connections</li>
                        <li>Usage data and analytics</li>
                    </ul>
                </div>

                <div class="legal-section">
                    <h2>AI Content and Your Rights</h2>
                    <p>When you use our AI-powered content generation features:</p>
                    <ul>
                        <li>You retain full ownership of all content you create</li>
                        <li>AI-generated suggestions become yours upon generation</li>
                        <li>We do not use your content to train our models without explicit consent</li>
                        <li>Your prompts and generated content are not shared with other users</li>
                    </ul>
                </div>

                <div class="legal-section">
                    <h2>We Do Not Sell Your Data</h2>
                    <p>Your privacy is paramount to us. We want to be crystal clear:</p>
                    <ul>
                        <li>We do not sell your personal information to third parties</li>
                        <li>We do not share your data for advertising purposes</li>
                        <li>We do not allow third parties to use your data for their own marketing</li>
                    </ul>
                </div>

                <div class="legal-section">
                    <h2>Data Security</h2>
                    <p>We implement industry-standard security measures to protect your data, including encryption, secure servers, and regular security audits.</p>
                </div>

                <div class="legal-section">
                    <h2>Contact</h2>
                    <p>For privacy-related inquiries, contact us at: privacy@cydrasocial.com</p>
                </div>
            </div>
        </div>
                
                ${PublicFooter()}
        `;
        }

        // Terms & Conditions Page (WEB-02)
        function TermsPage() {
            return `
                ${PublicNavbar()}

        <div class="legal-page">
            <div class="legal-content">
                <h1 class="legal-title">Terms & Conditions</h1>
                <p class="legal-updated">Last updated: ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>

                <div class="legal-section">
                    <h2>Age Eligibility</h2>
                    <p>You must be at least 18 years of age to use Cydra Social. By creating an account, you confirm that:</p>
                    <ul>
                        <li>You are at least 18 years old</li>
                        <li>You have the legal capacity to enter into a binding agreement</li>
                        <li>You are not prohibited from using our services under applicable law</li>
                    </ul>
                </div>

                <div class="legal-section">
                    <h2>Payment Terms</h2>
                    <p>By subscribing to a paid plan:</p>
                    <ul>
                        <li>You authorize us to charge your payment method on a recurring basis</li>
                        <li>Subscription fees are billed in advance on a monthly basis</li>
                        <li>You may cancel your subscription at any time; cancellation takes effect at the end of the current billing period</li>
                        <li>Refunds are provided on a case-by-case basis within 7 days of purchase</li>
                        <li>Prices may change with 30 days notice</li>
                    </ul>
                </div>

                <div class="legal-section">
                    <h2>Acceptable Use</h2>
                    <p>You agree not to use Cydra Social to:</p>
                    <ul>
                        <li>Generate or distribute illegal, harmful, or offensive content</li>
                        <li>Impersonate others or spread misinformation</li>
                        <li>Violate any applicable laws or regulations</li>
                        <li>Infringe on intellectual property rights</li>
                        <li>Attempt to access accounts or data belonging to others</li>
                    </ul>
                </div>

                <div class="legal-section">
                    <h2>Liability Disclaimers</h2>
                    <p>Cydra Social is provided "as is" without warranties of any kind. We disclaim all liability for:</p>
                    <ul>
                        <li>Indirect, incidental, or consequential damages</li>
                        <li>Loss of profits, data, or business opportunities</li>
                        <li>Actions taken based on AI-generated content suggestions</li>
                        <li>Third-party platform policy changes or account suspensions</li>
                    </ul>
                    <p>Our total liability shall not exceed the amount you paid for the service in the 12 months preceding the claim.</p>
                </div>

                <div class="legal-section">
                    <h2>Contact</h2>
                    <p>For legal inquiries, contact us at: legal@cydrasocial.com</p>
                </div>
            </div>
        </div>
                
                ${PublicFooter()}
        `;
        }

        // ==================== EVENT HANDLERS ====================
        let selectedPlatforms = [];
        let generatedVariants = [];

        function togglePlatform(platform) {
            const card = document.querySelector(`[data - platform= "${platform}"]`);
            if (selectedPlatforms.includes(platform)) {
                selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
                card.classList.remove('selected');
            } else {
                selectedPlatforms.push(platform);
                card.classList.add('selected');
            }
        }

        async function handleGenerateContent() {
            const topic = document.getElementById('topicInput').value;
            const tone = document.getElementById('toneSelect').value;

            if (!topic) {
                showToast('Please enter a topic');
                return;
            }

            if (selectedPlatforms.length === 0) {
                showToast('Please select at least one platform');
                return;
            }

            const output = document.getElementById('aiOutput');
            const grid = document.getElementById('variantsGrid');

            output.classList.remove('hidden');
            grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem;"><div class="spinner" style="margin: 0 auto;"></div><p style="margin-top: 1rem; color: var(--text-secondary);">Generating content...</p></div>';

            const variants = await generateAIContent(topic, tone, selectedPlatforms);
            generatedVariants = variants;

            grid.innerHTML = variants.map((variant, index) => `
            < div class="ai-variant-card" >
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">${AIAgents[variant.agent].name}</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 1rem;">${AIAgents[variant.agent].strategy}</div>
                    <div style="font-size: 0.875rem; line-height: 1.5; margin-bottom: 1rem; max-height: 150px; overflow-y: auto;">${variant.content}</div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="useVariant(${index})">Use This</button>
                </div >
            `).join('');
        }

        function useVariant(index) {
            const variant = generatedVariants[index];
            document.getElementById('finalContent').value = variant.content;
            document.getElementById('editorSection').classList.remove('hidden');
            document.getElementById('editorSection').scrollIntoView({ behavior: 'smooth' });
        }

        function handleSaveDraft() {
            const content = document.getElementById('finalContent').value;
            if (!content) {
                showToast('Please enter content');
                return;
            }

            const post = {
                workspaceId: store.state.currentWorkspace,
                content,
                platforms: selectedPlatforms,
                status: 'draft',
                date: null
            };

            store.addPost(post);
            store.addActivity({ type: 'draft', content: 'Saved new draft' });
            showToast('Draft saved successfully!');
            setTimeout(() => router.navigate('/content-library'), 1500);
        }

        function showScheduleModal() {
            if (store.state.user && store.state.user.emailVerified === false) {
                showEmailVerificationRequiredModal();
                return;
            }
            const content = document.getElementById('finalContent');
            if (!content || !content.value) {
                showToast('Please enter content');
                return;
            }
            const workspace = store.getCurrentWorkspace();
            const tz = (workspace && workspace.timezone) || Intl.DateTimeFormat().resolvedOptions().timeZone || 'America/New_York';
            const tzEl = document.getElementById('scheduleTimezoneValue');
            if (tzEl) tzEl.textContent = tz;
            const now = new Date();
            const minDate = now.toISOString().slice(0, 10);
            const minTime = new Date(now.getTime() + 15 * 60 * 1000);
            const minTimeStr = minTime.getHours().toString().padStart(2, '0') + ':' + minTime.getMinutes().toString().padStart(2, '0');
            const dateInput = document.getElementById('scheduleDate');
            const timeInput = document.getElementById('scheduleTime');
            if (dateInput) { dateInput.min = minDate; dateInput.value = minDate; }
            if (timeInput) { timeInput.min = minTimeStr; timeInput.value = minTimeStr; }
            const errEl = document.getElementById('scheduleError');
            if (errEl) { errEl.style.display = 'none'; errEl.textContent = ''; }
            document.getElementById('scheduleModal').classList.add('active');
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').classList.remove('active');
        }

        function handleSchedule() {
            const content = document.getElementById('finalContent').value;
            const dateStr = document.getElementById('scheduleDate').value;
            const timeStr = document.getElementById('scheduleTime').value;
            const errEl = document.getElementById('scheduleError');
            const helperEl = document.getElementById('scheduleHelper');

            if (!dateStr || !timeStr) {
                showToast('Please select date and time');
                return;
            }

            const scheduled = new Date(dateStr + 'T' + timeStr);
            const now = new Date();
            const minTime = new Date(now.getTime() + 15 * 60 * 1000);

            if (scheduled < now) {
                if (errEl) { errEl.style.display = 'block'; errEl.textContent = 'Cannot schedule in the past.'; }
                return;
            }
            if (scheduled < minTime) {
                if (errEl) { errEl.style.display = 'block'; errEl.textContent = 'Posts must be scheduled at least 15 minutes in advance.'; }
                return;
            }
            if (errEl) { errEl.style.display = 'none'; errEl.textContent = ''; }

            const workspace = store.getCurrentWorkspace();
            const tz = (workspace && workspace.timezone) || 'America/New_York';
            if (helperEl) helperEl.textContent = 'Your post will go live on ' + formatDate(scheduled.toISOString()) + ' at ' + formatTime(scheduled.toISOString()) + ' (' + tz + ').';

            const post = {
                workspaceId: store.state.currentWorkspace,
                content,
                platforms: selectedPlatforms,
                status: 'scheduled',
                date: scheduled.toISOString()
            };

            store.addPost(post);
            store.addActivity({ type: 'scheduled', content: `Scheduled post for ${formatDate(post.date)}` });
            showToast('Post scheduled successfully!');
            closeScheduleModal();
            setTimeout(() => router.navigate('/content-library'), 1500);
        }

        function handlePublishNow() {
            // AUTH-04: Soft Gate â€” block and show modal "Email Verification Required"
            if (store.state.user && store.state.user.emailVerified === false) {
                showEmailVerificationRequiredModal();
                return;
            }

            const content = document.getElementById('finalContent').value;
            if (!content) {
                showToast('Please enter content');
                return;
            }

            // Show publishing simulation modal (Demo Enhancement)
            const modal = document.createElement('div');
            modal.id = 'publishingModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px; text-align: center;">
                    <div class="spinner" style="margin: 0 auto 1.5rem;"></div>
                    <h3 style="margin-bottom: 1rem;">Publishing Content...</h3>
                    <div id="publishSteps" style="text-align: left; max-width: 300px; margin: 0 auto; color: var(--text-secondary);">
                        <div class="publish-step pending" id="step1" style="margin-bottom: 0.5rem;">â—‹ Preparing media assets...</div>
                        <div class="publish-step pending" id="step2" style="margin-bottom: 0.5rem;">â—‹ Connecting to platforms...</div>
                        <div class="publish-step pending" id="step3">â—‹ Finalizing post...</div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const steps = [
                { id: 'step1', text: 'âœ“ Media assets ready' },
                { id: 'step2', text: 'âœ“ Connected to platforms' },
                { id: 'step3', text: 'âœ“ Post published successfully!' }
            ];

            let currentStep = 0;
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    const stepEl = document.getElementById(steps[currentStep].id);
                    if (stepEl) {
                        stepEl.className = 'publish-step completed';
                        stepEl.style.color = '#10B981';
                        stepEl.textContent = steps[currentStep].text;
                    }
                    currentStep++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        modal.remove();
                        const post = {
                            workspaceId: store.state.currentWorkspace,
                            content,
                            platforms: selectedPlatforms,
                            status: 'published',
                            date: new Date().toISOString()
                        };

                        store.addPost(post);
                        store.addActivity({ type: 'published', content: `Published post to ${selectedPlatforms.join(', ')}` });
                        showToast('Post published successfully!');
                        router.navigate('/content-library');
                    }, 500);
                }
            }, 800);
        }

        // Create confetti celebration effect
        function createConfetti() {
            const colors = ['#635BFF', '#10B981', '#F59E0B', '#EC4899', '#3B82F6'];
            const container = document.body;

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    top: -10px;
                    left: ${Math.random() * 100}%;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    pointer-events: none;
                    z-index: 100000;
                    animation: confettiFall ${Math.random() * 2 + 2}s linear forwards;
                `;
                container.appendChild(confetti);
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        function filterPosts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#postsTableBody tr');

            rows.forEach(row => {
                const content = row.textContent.toLowerCase();
                const status = row.dataset.status;
                const matchesSearch = content.includes(searchTerm);
                const matchesStatus = !statusFilter || status === statusFilter;

                row.style.display = matchesSearch && matchesStatus ? '' : 'none';
            });
        }

        function deletePost(id) {
            if (confirm('Are you sure you want to delete this post?')) {
                store.deletePost(id);
                showToast('Post deleted');
                renderApp();
            }
        }

        function editPost(id) {
            showToast('Edit functionality - Demo mode');
        }

        function connectPlatform(platform) {
            const workspace = store.getCurrentWorkspace();
            workspace.connections[platform] = { connected: true, handle: `@${workspace.slug} ` };
            store.saveToStorage();
            showToast(`${platform} connected successfully!`);
            renderApp();
        }

        function disconnectPlatform(platform) {
            const workspace = store.getCurrentWorkspace();
            workspace.connections[platform] = { connected: false };
            store.saveToStorage();
            showToast(`${platform} disconnected`);
            renderApp();
        }

        // Workspace Management Handlers
        function handleWorkspaceSwitch(workspaceId) {
            store.switchWorkspace(workspaceId);
            showToast('Workspace switched');
            renderApp();
        }

        function handleOnboarding(e) {
            e.preventDefault();
            const workspace = {
                name: document.getElementById('workspaceName').value,
                industry: document.getElementById('industry').value,
                businessType: '',
                legalName: '',
                description: '',
                timezone: '',
                address: '',
                city: '',
                state: '',
                zip: '',
                country: '',
                website: '',
                phone: ''
            };

            const newWorkspace = store.addWorkspace(workspace);
            store.switchWorkspace(newWorkspace.id);
            showToast('Workspace created successfully!');
            router.navigate('/dashboard');
        }

        function handleCreateWorkspace(e) {
            e.preventDefault();

            // ONB-06: Solo Limit Simulation
            // Restrict creation if user already has 1 workspace and is not on Agency/Team plan (simulated)
            if (store.state.workspaces.length >= 1) {
                // Check if user is on a premium plan (mock check)
                // For demo purposes, we treat basic users as Solo
                showToast("Limit Reached: Solo plans can only manage 1 workspace.");
                showUpgradeModal(); // Trigger the upgrade flow
                return;
            }

            const workspace = {
                name: document.getElementById('name').value,
                legalName: document.getElementById('legalName').value,
                businessType: document.getElementById('businessType').value,
                industry: document.getElementById('industry').value,
                description: document.getElementById('description').value,
                timezone: document.getElementById('timezone').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zip: document.getElementById('zip').value,
                country: document.getElementById('country').value,
                website: document.getElementById('website').value,
                phone: document.getElementById('phone').value
            };

            const newWorkspace = store.addWorkspace(workspace);
            store.addActivity({ type: 'workspace', content: `Created workspace: ${workspace.name} ` });
            showToast('Workspace created successfully!');
            router.navigate('/workspaces');
        }

        function handleUpdateWorkspace(e, workspaceId) {
            e.preventDefault();
            const updates = {
                name: document.getElementById('name').value,
                legalName: document.getElementById('legalName').value,
                businessType: document.getElementById('businessType').value,
                industry: document.getElementById('industry').value,
                description: document.getElementById('description').value,
                timezone: document.getElementById('timezone').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zip: document.getElementById('zip').value,
                country: document.getElementById('country').value,
                website: document.getElementById('website').value,
                phone: document.getElementById('phone').value
            };

            store.updateWorkspace(workspaceId, updates);
            store.addActivity({ type: 'workspace', content: `Updated workspace: ${updates.name} ` });
            showToast('Workspace updated successfully!');
            router.navigate('/workspaces');
        }

        function handleDeleteWorkspace(id) {
            const workspace = store.getWorkspace(id);
            if (confirm(`Are you sure you want to delete "${workspace.name}" ? This will also delete all associated posts.`)) {
                store.deleteWorkspace(id);
                showToast('Workspace deleted');
                renderApp();
            }
        }

        function connectPlatformInEdit(platform) {
            const workspace = store.getCurrentWorkspace();
            workspace.connections[platform] = { connected: true, handle: `@${workspace.slug} ` };
            store.saveToStorage();
            showToast(`${platform} connected!`);
            renderApp();
        }

        function disconnectPlatformInEdit(platform) {
            const workspace = store.getCurrentWorkspace();
            workspace.connections[platform] = { connected: false, handle: '' };
            store.saveToStorage();
            showToast(`${platform} disconnected`);
            renderApp();
        }

        // ==================== KEY DEMO SIMULATION HELPERS ====================

        // BILL-P1-05: Simulation for "Manage Subscription"
        function handleManageSubscription() {
            showToast("Redirecting to Billing Portal...");
            setTimeout(() => {
                showToast("Opening Stripe Customer Portal (Demo)");
                // Could open a modal here, but toast is sufficient for intent
            }, 1000);
        }

        // BILL-P1-06: Simulation for Credit Top-Up
        function handleCreditTopUp(amount) {
            const cost = amount === 100 ? 10 : 45;
            if (confirm(`Purchase ${amount} AI Credits for $${cost}? (Demo Mode)`)) {
                showToast("Processing Payment...");
                setTimeout(() => {
                    store.state.workspaces.find(w => w.id === store.state.currentWorkspace).credits += amount;
                    store.saveToStorage();
                    createConfetti();
                    showToast(`Success! Added ${amount} credits.`);
                    renderApp(); // Refresh UI to show new credits
                }, 1500);
            }
        }

        // AUTH-04: Auto-Verify Simulation Logic
        // AUTH-04: Modal when user tries to Publish or Schedule while unverified
        function showEmailVerificationRequiredModal() {
            const modal = document.createElement('div');
            modal.id = 'emailVerificationModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">âœ‰ï¸</div>
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Email Verification Required</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Please verify your email to start posting or scheduling.</p>
                    <div style="display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="document.getElementById('emailVerificationModal').remove(); demoVerifyEmail();">Verify email (demo)</button>
                        <button class="btn btn-ghost" onclick="document.getElementById('emailVerificationModal').remove();">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // AUTH-04 Demo: One-click verify (simulates clicking the email link)
        function demoVerifyEmail() {
            if (!store.state.user) return;
            store.state.user.emailVerified = true;
            store.saveToStorage();
            updateVerificationBanner();
            renderApp();
            showToast('Email verified. You can now publish and schedule.');
        }

        function resendVerificationEmail() {
            showToast('Verification email sent to ' + (store.state.user?.email || 'your inbox') + '. Check your email.');

            // DEMO MAGIC: Auto-verify after 3 seconds to smooth out the presentation flow
            setTimeout(() => {
                showToast('âœ‰ï¸ (Demo) User clicked verification link...');
                setTimeout(() => {
                    store.state.user.emailVerified = true;
                    store.saveToStorage();
                    updateVerificationBanner();
                    showToast('âœ… Email Verified Successfully! You can now publish.');
                    // Refresh the current view to update state
                    renderApp();
                }, 1500);
            }, 3000);
        }

        // CONT-01, CONT-03, CONT-04 Examples
        let autoSaveTimer;

        function togglePlatform(platform) {
            const card = document.querySelector(`.platform-card[data-platform="${platform}"]`);
            if (!card) return; // Guard clause

            if (selectedPlatforms.includes(platform)) {
                selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
                card.classList.remove('selected');
            } else {
                selectedPlatforms.push(platform);
                card.classList.add('selected');
            }
            updateCharacterCount();
        }

        // CONT-01: Character limit â€” X=280, LinkedIn=3000, both=280 (lowest common denominator)
        function getPostCharacterLimit() {
            if (selectedPlatforms.includes('twitter')) return 280;
            if (selectedPlatforms.includes('linkedin')) return 3000;
            return 280; // default for empty selection
        }

        function updateCharacterCount(textarea) {
            const input = textarea || document.getElementById('finalContent');
            const limitDisplay = document.getElementById('charCount');
            if (!input || !limitDisplay) return;

            const max = getPostCharacterLimit();
            let content = input.value;
            if (content.length > max) {
                content = content.slice(0, max);
                input.value = content;
                showToast('Text truncated to fit X limit.');
            }
            input.setAttribute('maxlength', max);

            limitDisplay.textContent = `${content.length} / ${max}`;
            const pct = max ? (content.length / max) * 100 : 0;
            limitDisplay.style.fontWeight = pct >= 95 ? 'bold' : 'normal';
            if (pct >= 95) limitDisplay.style.color = '#EF4444';
            else if (pct >= 80) limitDisplay.style.color = '#D97706';
            else limitDisplay.style.color = '#059669';
        }

        function handlePostContentPaste(e) {
            const input = document.getElementById('finalContent');
            if (!input) return;
            const max = getPostCharacterLimit();
            e.preventDefault();
            const pasted = (e.clipboardData || window.clipboardData).getData('text');
            const current = input.value;
            const start = input.selectionStart || 0;
            const end = input.selectionEnd || start;
            const newText = current.slice(0, start) + pasted + current.slice(end);
            if (newText.length > max) {
                const truncated = newText.slice(0, max);
                input.value = truncated;
                input.setSelectionRange(truncated.length, truncated.length);
                showToast('Text truncated to fit X limit.');
            } else {
                input.value = newText;
            }
            updateCharacterCount(input);
            startAutoSaveTimer();
        }

        function handleMediaUpload(input) {
            const status = document.getElementById('uploadStatus');
            const preview = document.getElementById('mediaPreview');
            const previewImg = document.getElementById('previewImage');

            if (input.files && input.files[0]) {
                const file = input.files[0];

                // CONT-03: Validation
                // Type Validation
                const validTypes = ['image/jpeg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    showToast('âŒ Invalid format. JPG or PNG only.');
                    input.value = ''; // Reset
                    return;
                }

                // Size Validation (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('File too large. Please compress to under 5MB.');
                    input.value = '';
                    return;
                }

                if (status) status.textContent = 'Uploading...';

                // Simulate Upload & Preview
                const reader = new FileReader();
                reader.onload = function (e) {
                    if (previewImg) previewImg.src = e.target.result;
                    if (preview) preview.style.display = 'block';
                    if (status) status.textContent = '';
                    showToast('âœ… Image attached successfully');
                }
                reader.readAsDataURL(file);
            }
        }

        function removeMedia() {
            const input = document.getElementById('mediaUpload');
            const preview = document.getElementById('mediaPreview');
            const previewImg = document.getElementById('previewImage');
            const altText = document.getElementById('altText');

            if (input) input.value = '';
            if (previewImg) previewImg.src = '';
            if (preview) preview.style.display = 'none';
            if (altText) altText.value = '';

            showToast('Image removed');
        }

        async function handleGenerateContent() {
            const topic = document.getElementById('topicInput').value;
            const tone = document.getElementById('toneSelect') ? document.getElementById('toneSelect').value : 'Professional';

            if (!topic) {
                showToast('Please enter a topic');
                return;
            }

            const output = document.getElementById('aiOutput');
            output.classList.remove('hidden');
            output.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div class="spinner"></div>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">AI Gathering insights and drafting content...</p>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Agents active: Viral, Community, SEO, Curator</p>
                </div>
            `;

            try {
                // Use the new multi-agent logic
                const variants = await generateAIContent(topic, tone, selectedPlatforms);

                let variantsHTML = `<h3 style="font-weight: 600; margin-bottom: 1rem;">AI Generated Variants</h3><div class="grid-auto grid-2" style="gap: 1rem;">`;

                variants.forEach(v => {
                    const agentInfo = AIAgents[v.agent];
                    // Escape content for safe function call
                    const safeContent = v.content.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/\n/g, "\\n");

                    variantsHTML += `
                        <div class="card" style="border: 1px solid var(--border); display: flex; flex-direction: column;">
                            <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <div style="font-weight: 600; color: var(--primary);">${agentInfo.name}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary);">${agentInfo.strategy}</div>
                                </div>
                                <span class="badge" style="background: #E0E7FF; color: #4338CA; text-transform: capitalize;">${v.agent}</span>
                            </div>
                            <div style="flex: 1; margin-bottom: 1rem; white-space: pre-wrap; font-size: 0.9rem; background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem;">${v.content}</div>
                            <button class="btn btn-primary" style="width: 100%;" onclick="acceptGeneratedContent('${safeContent}')">Use This Variant</button>
                        </div>
                    `;
                });

                variantsHTML += `</div>`;
                output.innerHTML = variantsHTML;

            } catch (error) {
                output.innerHTML = `
                    <div class="card" style="text-align: center; color: #EF4444; padding: 2rem;">
                        <h3>Generation Failed</h3>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary" onclick="handleGenerateContent()">Try Again</button>
                    </div>
                `;
            }
        }

        function handleRefineContent(type) {
            showToast(`Refining content (${type})...`);
            // CONT-02: Simulate refinement
            const output = document.getElementById('aiOutput');
            const spinnerHTML = `<div class="spinner" style="width: 20px; height: 20px; display: inline-block;"></div> Refining...`;
            // Simple visual feedback only for demo
        }

        function acceptGeneratedContent(text) {
            document.getElementById('editorSection').classList.remove('hidden');
            const finalInput = document.getElementById('finalContent');
            finalInput.value = text;
            updateCharacterCount(finalInput);
            finalInput.scrollIntoView({ behavior: 'smooth' });
        }

        function startAutoSaveTimer() {
            const indicator = document.getElementById('autoSaveIndicator');
            if (indicator) indicator.textContent = 'Typing...';

            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                handleSaveDraft(true);
            }, 2000); // Auto-save after 2s of inactivity
        }

        function handleSaveDraft(silent = false) {
            if (!silent) showToast('Draft saved successfully');
            const indicator = document.getElementById('autoSaveIndicator');
            if (indicator) {
                const time = new Date().toLocaleTimeString();
                indicator.textContent = `Draft saved at ${time}`;
            }
            // Logic to actually save to store could go here
        }

        // ==================== AUTHENTICATION HELPERS (Epic 2) ====================

        // Email validation regex
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        // Password validation: 8-12 alphanumeric characters (AUTH-01)
        function validatePasswordStrength(password) {
            const minLength = password.length >= 8;
            const maxLength = password.length <= 12;
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const isAlphanumeric = /^[a-zA-Z0-9]+$/.test(password);

            let strength = 'weak';
            let score = 0;

            if (minLength) score++;
            if (maxLength) score++;
            if (hasLetter) score++;
            if (hasNumber) score++;
            if (isAlphanumeric && minLength && maxLength) score++;

            if (score <= 2) strength = 'weak';
            else if (score <= 4) strength = 'medium';
            else strength = 'strong';

            return {
                isValid: minLength && maxLength && hasLetter && hasNumber && isAlphanumeric,
                strength,
                minLength,
                maxLength,
                hasLetter,
                hasNumber,
                isAlphanumeric
            };
        }

        // Real-time login email validation (AUTH-08)
        function validateLoginEmail(input) {
            const icon = document.getElementById('loginEmailIcon');
            const msg = document.getElementById('loginEmailMsg');

            if (!input.value) {
                input.classList.remove('valid', 'invalid');
                icon.textContent = '';
                msg.textContent = '';
                return;
            }

            if (emailRegex.test(input.value)) {
                input.classList.remove('invalid');
                input.classList.add('valid');
                icon.textContent = 'âœ“';
                icon.style.color = '#10B981';
                msg.textContent = '';
            } else {
                input.classList.remove('valid');
                input.classList.add('invalid');
                icon.textContent = 'âœ—';
                icon.style.color = '#EF4444';
                msg.textContent = 'Please enter a valid email address';
                msg.className = 'validation-message error';
            }
        }

        // Real-time signup name validation (AUTH-08)
        function validateSignupName(input) {
            const icon = document.getElementById('signupNameIcon');
            const msg = document.getElementById('signupNameMsg');

            if (!input.value) {
                input.classList.remove('valid', 'invalid');
                icon.textContent = '';
                msg.textContent = '';
                return;
            }

            if (input.value.trim().length >= 2) {
                input.classList.remove('invalid');
                input.classList.add('valid');
                icon.textContent = 'âœ“';
                icon.style.color = '#10B981';
                msg.textContent = '';
            } else {
                input.classList.remove('valid');
                input.classList.add('invalid');
                icon.textContent = 'âœ—';
                icon.style.color = '#EF4444';
                msg.textContent = 'Name must be at least 2 characters';
                msg.className = 'validation-message error';
            }
        }

        // Real-time signup email validation (AUTH-08)
        function validateSignupEmail(input) {
            const icon = document.getElementById('signupEmailIcon');
            const msg = document.getElementById('signupEmailMsg');

            if (!input.value) {
                input.classList.remove('valid', 'invalid');
                icon.textContent = '';
                msg.textContent = '';
                return;
            }

            if (emailRegex.test(input.value)) {
                input.classList.remove('invalid');
                input.classList.add('valid');
                icon.textContent = 'âœ“';
                icon.style.color = '#10B981';
                msg.textContent = '';
            } else {
                input.classList.remove('valid');
                input.classList.add('invalid');
                icon.textContent = 'âœ—';
                icon.style.color = '#EF4444';
                msg.textContent = 'Please enter a valid work email address';
                msg.className = 'validation-message error';
            }
        }

        // Real-time password validation with strength meter (AUTH-08)
        function validatePassword(input) {
            const icon = document.getElementById('signupPasswordIcon');
            const msg = document.getElementById('signupPasswordMsg');
            const strengthContainer = document.getElementById('passwordStrength');
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');

            if (!input.value) {
                input.classList.remove('valid', 'invalid');
                icon.textContent = '';
                msg.textContent = '';
                strengthContainer.style.display = 'none';
                return;
            }

            strengthContainer.style.display = 'block';
            const result = validatePasswordStrength(input.value);

            // Update strength meter
            strengthFill.className = 'strength-fill ' + result.strength;

            if (result.strength === 'weak') {
                strengthText.textContent = 'Weak password';
                strengthText.style.color = '#EF4444';
            } else if (result.strength === 'medium') {
                strengthText.textContent = 'Medium password';
                strengthText.style.color = '#F59E0B';
            } else {
                strengthText.textContent = 'Strong password';
                strengthText.style.color = '#10B981';
            }

            // Update validation status
            if (result.isValid) {
                input.classList.remove('invalid');
                input.classList.add('valid');
                icon.textContent = 'âœ“';
                icon.style.color = '#10B981';
                msg.textContent = '';
            } else {
                input.classList.remove('valid');
                input.classList.add('invalid');
                icon.textContent = 'âœ—';
                icon.style.color = '#EF4444';

                let errorMsg = 'Password must be 8-12 characters.';
                if (!result.isAlphanumeric) errorMsg = 'Password must contain letters and numbers only.';
                else if (!result.minLength || !result.maxLength) errorMsg = 'Password must be 8-12 characters.';

                msg.textContent = errorMsg;
                msg.className = 'validation-message error';
            }
        }

        // SSO Login handler (AUTH-02)
        function handleSSOLogin(provider) {
            showToast(`Connecting with ${provider.charAt(0).toUpperCase() + provider.slice(1)}...`);
            // Simulate SSO authentication delay
            setTimeout(() => {
                store.setUser({
                    email: `demo @${provider}.com`,
                    name: 'SSO User',
                    provider: provider,
                    emailVerified: true // SSO accounts are pre-verified
                });
                showToast(`Welcome! Signed in with ${provider.charAt(0).toUpperCase() + provider.slice(1)} `);
                router.navigate('/dashboard');
            }, 1500);
        }

        // SSO Signup handler (AUTH-02)
        function handleSSOSignup(provider) {
            showToast(`Connecting with ${provider.charAt(0).toUpperCase() + provider.slice(1)}...`);
            // Simulate SSO authentication delay
            setTimeout(() => {
                store.setUser({
                    email: `demo @${provider}.com`,
                    name: 'SSO User',
                    provider: provider,
                    emailVerified: true // SSO accounts are pre-verified
                });
                showToast(`Welcome! Account created with ${provider.charAt(0).toUpperCase() + provider.slice(1)} `);

                // Check for stored plan preference (WEB-03)
                const selectedPlan = localStorage.getItem('selectedPlan');
                if (selectedPlan) {
                    localStorage.removeItem('selectedPlan');
                    showToast(`Plan selected: ${selectedPlan.charAt(0).toUpperCase() + selectedPlan.slice(1)} `);
                }
                router.navigate('/onboarding');
            }, 1500);
        }

        // Forgot Password Modal (AUTH-05, AUTH-06)
        function showForgotPassword() {
            const modal = document.createElement('div');
            modal.id = 'forgotPasswordModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeForgotPassword()"></div>
                <div class="modal-content" style="max-width: 400px;">
                    <div class="modal-header">
                        <h3>Forgot Password</h3>
                        <button onclick="closeForgotPassword()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Enter your email address and we'll send you a link to reset your password.
                        </p>
                        <form onsubmit="handleForgotPassword(event)">
                            <div class="form-row">
                                <label for="forgotEmail">Email Address</label>
                                <input type="email" id="forgotEmail" class="input" placeholder="name@business.com" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Send Reset Link</button>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeForgotPassword() {
            const modal = document.getElementById('forgotPasswordModal');
            if (modal) modal.remove();
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;

            // AUTH-05: Security best practice â€” same message whether account exists or not
            showToast('If an account exists, we have sent a reset link.');
            closeForgotPassword();

            // Note: In production, this would:
            // 1. Generate a secure token (expires in 1 hour per AUTH-06)
            // 2. Send email with reset link
            // 3. Store token with expiration timestamp
        }

        // Resend verification email (AUTH-04)
        // (AUTH-04) resendVerificationEmail is defined in the Helper Functions section

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Validate email format
            if (!emailRegex.test(email)) {
                document.getElementById('loginError').style.display = 'block';
                return;
            }

            // OPS-P1: Super Admin Login
            if (email === 'admin@cydra.com' && password === 'admin123') {
                store.setUser({
                    email: email,
                    name: 'Super Admin',
                    role: 'admin',
                    emailVerified: true
                });
                showToast('ðŸ” Logged in as Super Admin');
                router.navigate('/admin');
                return;
            }

            // Simulate authentication (in production, this would call an API)
            // AUTH-03: Always show generic error message for security
            const isValidCredentials = true; // Demo: always succeed

            if (isValidCredentials) {
                store.setUser({
                    email: email,
                    name: 'Demo User',
                    emailVerified: false // Will show verification banner
                });
                showToast('Welcome back!');
                router.navigate('/dashboard');
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function handleSignup(e) {
            e.preventDefault();

            // Get form values
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            // Validate all fields (AUTH-01)
            if (!name || name.trim().length < 2) {
                showToast('Please enter a valid name');
                return;
            }

            if (!emailRegex.test(email)) {
                showToast('Please enter a valid email address');
                return;
            }

            const passwordCheck = validatePasswordStrength(password);
            if (!passwordCheck.isValid) {
                showToast('Please enter a valid password (8-12 alphanumeric characters)');
                return;
            }

            // Create user account (AUTH-04: emailVerified starts as false)
            store.setUser({
                email: email,
                name: name,
                emailVerified: false // Verification email will be sent
            });
            showToast('Account created! Please check your email to verify your account.');

            // WEB-03: Check for stored plan preference
            const selectedPlan = localStorage.getItem('selectedPlan');
            if (selectedPlan) {
                // Clear the stored plan after using it
                localStorage.removeItem('selectedPlan');
                // Show confirmation with the selected plan
                showToast(`Plan selected: ${selectedPlan.charAt(0).toUpperCase() + selectedPlan.slice(1)}`);
                // In a real app, this would redirect to checkout (BILL-01) with plan pre-selected
                // For now, proceed to onboarding
                router.navigate('/onboarding');
            } else {
                // No plan selected, proceed to onboarding where they can select a plan
                router.navigate('/onboarding');
            }
        }

        function handleLogout() {
            store.logout();
            showToast('Logged out successfully');
            router.navigate('/'); // Redirect to root (which goes to Home)
        }

        // ==================== ROUTER SETUP ====================
        // Public pages (WEB-01, WEB-02)
        router.register('/home', () => renderApp(HomePage()));
        router.register('/about', () => renderApp(AboutPage()));
        router.register('/privacy', () => renderApp(PrivacyPage()));
        router.register('/terms', () => renderApp(TermsPage()));

        // Auth pages
        router.register('/login', () => {
            if (store.state.user) {
                router.navigate('/dashboard');
                return;
            }
            renderApp(LoginPage());
        });
        router.register('/signup', () => {
            if (store.state.user) {
                router.navigate('/dashboard');
                return;
            }
            renderApp(SignupPage());
        });
        router.register('/dashboard', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(DashboardPage());
        });
        router.register('/create-post', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            selectedPlatforms = [];
            generatedVariants = [];
            renderApp(CreatePostPage());
        });
        router.register('/content-library', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(ContentLibraryPage());
        });
        router.register('/media-library', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(MediaLibraryPage());
        });
        router.register('/calendar', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(CalendarPage());
        });
        router.register('/onboarding', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(OnboardingPage());
        });
        router.register('/select-plan', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(PlanSelectionPage());
        });
        router.register('/checkout', (params) => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            const workspace = store.getCurrentWorkspace();
            if (!workspace) {
                showToast('Please create a workspace first');
                router.navigate('/onboarding');
                return;
            }
            const plan = (params && params[0]) || 'solo';
            renderApp(CheckoutPage(plan));
            setupCheckoutAddonListeners(plan);
        });
        router.register('/workspaces', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(WorkspacesListPage());
        });
        router.register('/create-workspace', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(CreateWorkspacePage());
        });
        router.register('/edit-workspace', (params) => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(EditWorkspacePage(params));
        });
        router.register('/workspace-settings', (params) => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(WorkspaceSettingsPage(params));
        });
        router.register('/connected-accounts', () => {
            if (!store.state.user) {
                router.navigate('/login');
                return;
            }
            renderApp(ConnectedAccountsPage());
        });
        router.register('/admin', () => {
            if (store.state.user?.role !== 'admin') {
                router.navigate('/login');
                return;
            }
            renderApp(AdminDashboardPage());
        });
        router.register('/', () => {
            if (store.state.user) {
                router.navigate('/dashboard');
            } else {
                // WEB-01: Show public home page for visitors
                router.navigate('/home');
            }
        });
        router.register('*', () => router.navigate('/'));

        // ==================== RENDER ====================
        // ==================== RENDER ====================
        function renderApp(content) {
            document.getElementById('app').innerHTML = content || '';
            document.documentElement.classList.toggle('dark', store.state.darkMode);
            updateVerificationBanner(); // Check and update banner
        }

        // Update verification banner visibility (Demo Enhancement)
        function updateVerificationBanner() {
            let banner = document.getElementById('verification-banner');
            const shouldShow = store.state.user && store.state.user.emailVerified === false;

            if (shouldShow) {
                if (!banner) {
                    banner = document.createElement('div');
                    banner.id = 'verification-banner';
                    banner.style.cssText = 'background: #F59E0B; color: white; padding: 0.75rem; text-align: center; font-weight: 500; width: 100%; position: relative; z-index: 1001; box-shadow: 0 2px 4px rgba(0,0,0,0.1);';
                    banner.innerHTML = `
                        âš ï¸ Please verify your email to start posting.
                        <button type="button" onclick="resendVerificationEmail()" style="margin-left: 0.5rem; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Resend verification email</button>
                        <button type="button" onclick="demoVerifyEmail()" style="margin-left: 0.5rem; background: rgba(255,255,255,0.3); border: 1px solid white; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Verify email (demo)</button>
                    `;
                    // Insert before #app
                    const app = document.getElementById('app');
                    if (app && app.parentNode) {
                        app.parentNode.insertBefore(banner, app);
                    } else {
                        document.body.prepend(banner);
                    }
                }
            } else {
                if (banner) banner.remove();
            }
        }

        // ==================== DEMO UTILITIES ====================
        // Reset demo data to initial state
        function resetDemoData() {
            if (confirm('ðŸŽ­ Reset Demo?\n\nThis will clear all data and return to the initial demo state.\n\nPress OK to reset, Cancel to continue.')) {
                localStorage.clear();
                showToast('ðŸ”„ Resetting demo data...');
                setTimeout(() => {
                    window.location.reload();
                }, 500);
            }
        }

        // Show out of credits modal
        function showOutOfCreditsModal() {
            const modal = document.createElement('div');
            modal.id = 'creditsModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">âš¡</div>
                    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Out of AI Credits</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        You've used all your AI credits for this billing period. 
                        Upgrade your plan or purchase additional credits to continue.
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-secondary" onclick="document.getElementById('creditsModal').remove(); showToast('ðŸ’³ Demo: Credits topped up!'); const ws = store.getCurrentWorkspace(); if(ws) { ws.aiCredits = 50; store.saveToStorage(); }">
                            Top Up Credits
                        </button>
                        <button class="btn btn-primary" onclick="document.getElementById('creditsModal').remove(); router.navigate('/select-plan');">
                            Upgrade Plan
                        </button>
                    </div>
                    <button style="margin-top: 1rem; background: none; border: none; color: var(--text-secondary); cursor: pointer;" onclick="document.getElementById('creditsModal').remove()">
                        Maybe Later
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Get credit badge HTML
        function getCreditBadgeHTML(credits) {
            let badgeClass = 'credit-badge';
            if (credits <= 5) {
                badgeClass += ' critical';
            } else if (credits <= 15) {
                badgeClass += ' low';
            }
            return `<span class="${badgeClass}">âš¡ ${credits} credits</span>`;
        }

        // Decrement AI credits
        function decrementAICredits(amount = 1) {
            const workspace = store.getCurrentWorkspace();
            if (!workspace) return true;

            if (!workspace.aiCredits || workspace.aiCredits <= 0) {
                showOutOfCreditsModal();
                return false;
            }

            workspace.aiCredits -= amount;
            store.saveToStorage();

            if (workspace.aiCredits <= 0) {
                showOutOfCreditsModal();
                return false;
            }

            return true;
        }

        // Keyboard shortcuts for demo mode
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+R: Reset demo data
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                resetDemoData();
            }
            // Dark mode toggle removed
        });

        // Add demo mode banner
        function addDemoBanner() {
            const banner = document.createElement('div');
            banner.className = 'demo-banner';
            banner.innerHTML = `
                ðŸŽ­ <strong>Demo Mode</strong> â€” Press <kbd>Ctrl+Shift+R</kbd> to reset
            `;
            document.body.appendChild(banner);
        }

        // Initialize
        if (store.state.darkMode) {
            document.documentElement.classList.add('dark');
        }

        // Add demo banner on load
        window.addEventListener('DOMContentLoaded', addDemoBanner);
    </script>
</body>

</html>